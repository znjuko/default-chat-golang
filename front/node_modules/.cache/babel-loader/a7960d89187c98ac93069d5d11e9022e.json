{"ast":null,"code":"var _jsxFileName = \"/home/znjuko/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/rk2/bmstu_front/default-chat-golang/front/src/pages/Messages.js\";\nimport React from 'react';\nimport API from '../utils/API';\nimport connectSocket from '../utils/Socket';\nimport Emojie from '../mixins/emojie';\nimport { Link, useParams } from 'react-router-dom';\nimport Message from '../mixins/Message';\nimport AddEmojie from '../mixins/addEmojie';\nimport { Popover, PopoverBody, PopoverHeader, Button, Modal, ModalBody, ModalHeader } from 'shards-react';\nexport default class Messages extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onEmojie = e => {\n      console.log(e.target);\n      console.log(e.target.className);\n      if (e.target.className === 'fas fa-smile-wink' || e.target.className === 'btn btn-light') this.setState({\n        showEmojie: !this.state.showEmojie\n      });\n    };\n\n    this.addSticker = e => {\n      this.setState({\n        openAddEmojie: true\n      });\n    };\n\n    this.onBack = e => {\n      const {\n        history\n      } = this.props;\n      history.push('/chats');\n    };\n\n    this.onChangeMessage = e => {\n      console.log(e.target.value);\n      this.setState({\n        textMessage: e.target.value\n      });\n    };\n\n    this.onSendMessage = e => {\n      if (this.state.textMessage !== '') {\n        console.log({\n          txt: this.state.textMessage,\n          chatId: this.state.chatId\n        });\n        window.socket.send(JSON.stringify({\n          txt: this.state.textMessage,\n          chatId: this.state.chatId\n        }));\n        var notes = this.refs.notes;\n        notes.value = '';\n        this.setState({\n          textMessage: ''\n        });\n      }\n    };\n\n    const {\n      match: {\n        params\n      }\n    } = this.props;\n    this.insertEmojie = this.insertEmojie.bind(this);\n    this.closeAddSticker = this.closeAddSticker.bind(this);\n    this.state = {\n      chatId: parseInt(params.chatId),\n      chatInfo: {\n        chatName: 'chat'\n      },\n      messages: [],\n      textMessage: '',\n      showEmojie: false,\n      allEmojies: [],\n      openAddEmojie: false\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid flex-column align-items-center h-100 mt-2 d-flex justify-content-between\",\n      style: {\n        minHeight: '90vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"h-100  w-75 d-flex justify-content-center\",\n      style: {\n        height: '20%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"h-100 d-flex justify-content-between align-items-center w-100 border-bottom border-white\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.onBack,\n      activeclassname: \"active\",\n      className: \"d-inline-flex btn btn-outline-info btn-pill\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-undo-alt\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55,\n        columnNumber: 8\n      }\n    })), /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"h4 mt-2  d-inline-flex\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 7\n      }\n    }, this.state.chatInfo.chatName)), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-75 d-flex justify-content-center position-fixed-bottom mx-auto\",\n      style: {\n        minHeight: '80vh',\n        marginBottom: '80px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(Message, {\n      history: this.props.history,\n      messages: this.state.messages,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-75 d-flex justify-content-center fixed-bottom mx-auto\",\n      style: {\n        maxHeight: '20%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-group mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-group-prepend\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-light\",\n      type: \"button\",\n      id: \"emojie\",\n      name: \"emojie\",\n      style: {\n        fontSize: '2rem'\n      },\n      onClick: this.onEmojie,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-smile-wink\",\n      name: \"emojie2\",\n      onClick: this.onEmojie,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Popover, {\n      placement: \"top\",\n      open: this.state.showEmojie,\n      toggle: this.onEmojie,\n      target: \"#emojie\",\n      className: \"overflow-hidden\",\n      style: {\n        minHeight: '400px',\n        minWidth: '280px',\n        maxHeight: '400px',\n        overflowY: 'scroll'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(PopoverHeader, {\n      className: \"d-flex justify-content-between align-items-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }\n    }, \"\\u0421\\u0442\\u0438\\u043A\\u0435\\u0440\\u044B\", /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.addSticker,\n      activeClassName: \"active\",\n      className: \"d-inline-flex btn btn-outline-info btn-pill\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-plus-circle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }\n    }))), /*#__PURE__*/React.createElement(PopoverBody, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Emojie, {\n      history: this.props.history,\n      chatId: this.state.chatId,\n      emojies: this.state.allEmojies,\n      func: this.insertEmojie,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 10\n      }\n    }))), /*#__PURE__*/React.createElement(AddEmojie, {\n      open: this.state.openAddEmojie,\n      closeAddSticker: this.closeAddSticker,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 8\n      }\n    })), /*#__PURE__*/React.createElement(\"textarea\", {\n      ref: \"notes\",\n      type: \"text\",\n      className: \"form-control\",\n      placeholder: \"\",\n      \"aria-label\": \"\",\n      \"aria-describedby\": \"basic-addon1\",\n      style: {\n        resize: 'none'\n      },\n      onChange: this.onChangeMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-group-append\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      type: \"button\",\n      onClick: this.onSendMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 8\n      }\n    }, \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\")))));\n  }\n\n  closeAddSticker() {\n    this.setState({\n      openAddEmojie: false\n    });\n  }\n\n  insertEmojie(text) {\n    console.log(text);\n    var notes = this.refs.notes;\n    notes.value += text;\n    this.setState({\n      textMessage: notes.value\n    });\n  }\n\n  async componentDidMount() {\n    // Load async data.\n    try {\n      if (!window.socket) {\n        await connectSocket();\n      } // data: \"{\"event\":\"new message\",\"message\":{\"author\":\"poi\",\"txt\":\"sdga\",\"chatName\":\"Snow\",\"chatId\":9,\"emojies\":null}}↵\"\n\n\n      window.socket.onmessage = function (event) {\n        console.log('[WS] Message', event);\n        var data = JSON.parse(event.data);\n        console.log(data);\n        console.log(data.message);\n\n        if (data.message.chatId === this.state.chatId) {\n          let newMsg = {\n            author: data.message.author,\n            txt: data.message.txt,\n            chatName: data.message.chatName,\n            chatId: data.message.chatId,\n            emojies: data.message.emojies\n          };\n          this.setState({\n            messages: [newMsg, ...this.state.messages]\n          });\n          console.log('[Add msg]');\n        }\n      }.bind(this);\n\n      let mainData = await API.get(`/chats/${this.state.chatId}`, {\n        params: {\n          results: 1,\n          inc: 'chatInfo,messages'\n        }\n      }); // Парсим резульатты.\n\n      console.log(mainData);\n      let chatInfo = mainData.data.chatInfo;\n      let messages = mainData.data.messages;\n      let allEmojies = mainData.data.allEmojies; // Обновляем стейт и ререндерим наш компонент.\n\n      console.log('[DEBUG]: Chat answer');\n      console.log(mainData.data);\n      this.setState({ ...this.state,\n        ...{\n          chatInfo: chatInfo,\n          messages: messages,\n          allEmojies: allEmojies\n        }\n      });\n    } catch (err) {\n      console.log(`[DEBUG]: /chats/${this.state.chatId} error`);\n      console.log(err);\n    }\n  }\n\n}","map":{"version":3,"sources":["/home/znjuko/Рабочий стол/rk2/bmstu_front/default-chat-golang/front/src/pages/Messages.js"],"names":["React","API","connectSocket","Emojie","Link","useParams","Message","AddEmojie","Popover","PopoverBody","PopoverHeader","Button","Modal","ModalBody","ModalHeader","Messages","Component","constructor","props","onEmojie","e","console","log","target","className","setState","showEmojie","state","addSticker","openAddEmojie","onBack","history","push","onChangeMessage","value","textMessage","onSendMessage","txt","chatId","window","socket","send","JSON","stringify","notes","refs","match","params","insertEmojie","bind","closeAddSticker","parseInt","chatInfo","chatName","messages","allEmojies","render","minHeight","height","marginBottom","maxHeight","fontSize","minWidth","overflowY","resize","text","componentDidMount","onmessage","event","data","parse","message","newMsg","author","emojies","mainData","get","results","inc","err"],"mappings":"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","sourcesContent":["import React from 'react';\nimport API from '../utils/API';\nimport connectSocket from '../utils/Socket';\nimport Emojie from '../mixins/emojie';\nimport { Link, useParams } from 'react-router-dom';\nimport Message from '../mixins/Message';\nimport AddEmojie from '../mixins/addEmojie';\n\nimport {\n\tPopover,\n\tPopoverBody,\n\tPopoverHeader,\n\tButton,\n\tModal,\n\tModalBody,\n\tModalHeader,\n} from 'shards-react';\n\nexport default class Messages extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tconst {\n\t\t\tmatch: { params },\n\t\t} = this.props;\n\n\t\tthis.insertEmojie = this.insertEmojie.bind(this);\n\t\tthis.closeAddSticker = this.closeAddSticker.bind(this);\n\t\tthis.state = {\n\t\t\tchatId: parseInt(params.chatId),\n\t\t\tchatInfo: {\n\t\t\t\tchatName: 'chat',\n\t\t\t},\n\t\t\tmessages: [],\n\t\t\ttextMessage: '',\n\t\t\tshowEmojie: false,\n\t\t\tallEmojies: [],\n\t\t\topenAddEmojie: false,\n\t\t};\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName='container-fluid flex-column align-items-center h-100 mt-2 d-flex justify-content-between'\n\t\t\t\tstyle={{ minHeight: '90vh' }}>\n\t\t\t\t<div\n\t\t\t\t\tclassName='h-100  w-75 d-flex justify-content-center'\n\t\t\t\t\tstyle={{ height: '20%' }}>\n\t\t\t\t\t<div className='h-100 d-flex justify-content-between align-items-center w-100 border-bottom border-white'>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={this.onBack}\n\t\t\t\t\t\t\tactiveclassname='active'\n\t\t\t\t\t\t\tclassName='d-inline-flex btn btn-outline-info btn-pill'>\n\t\t\t\t\t\t\t<i className='fas fa-undo-alt'></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<h4 className='h4 mt-2  d-inline-flex'>\n\t\t\t\t\t\t\t{this.state.chatInfo.chatName}\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<hr />\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName='w-75 d-flex justify-content-center position-fixed-bottom mx-auto'\n\t\t\t\t\tstyle={{ minHeight: '80vh', marginBottom: '80px' }}>\n\t\t\t\t\t<Message\n\t\t\t\t\t\thistory={this.props.history}\n\t\t\t\t\t\tmessages={this.state.messages}></Message>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName='w-75 d-flex justify-content-center fixed-bottom mx-auto'\n\t\t\t\t\tstyle={{ maxHeight: '20%' }}>\n\t\t\t\t\t<div className='input-group mb-3'>\n\t\t\t\t\t\t<div className='input-group-prepend'>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName='btn btn-light'\n\t\t\t\t\t\t\t\ttype='button'\n\t\t\t\t\t\t\t\tid='emojie'\n\t\t\t\t\t\t\t\tname='emojie'\n\t\t\t\t\t\t\t\tstyle={{ fontSize: '2rem' }}\n\t\t\t\t\t\t\t\tonClick={this.onEmojie}>\n\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\tclassName='fas fa-smile-wink'\n\t\t\t\t\t\t\t\t\tname='emojie2'\n\t\t\t\t\t\t\t\t\tonClick={this.onEmojie}></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\t\tplacement='top'\n\t\t\t\t\t\t\t\topen={this.state.showEmojie}\n\t\t\t\t\t\t\t\ttoggle={this.onEmojie}\n\t\t\t\t\t\t\t\ttarget='#emojie'\n\t\t\t\t\t\t\t\tclassName='overflow-hidden'\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tminHeight: '400px',\n\t\t\t\t\t\t\t\t\tminWidth: '280px',\n\t\t\t\t\t\t\t\t\tmaxHeight: '400px',\n\t\t\t\t\t\t\t\t\toverflowY: 'scroll',\n\t\t\t\t\t\t\t\t}}>\n\t\t\t\t\t\t\t\t<PopoverHeader className='d-flex justify-content-between align-items-center'>\n\t\t\t\t\t\t\t\t\tСтикеры\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonClick={this.addSticker}\n\t\t\t\t\t\t\t\t\t\tactiveClassName='active'\n\t\t\t\t\t\t\t\t\t\tclassName='d-inline-flex btn btn-outline-info btn-pill'>\n\t\t\t\t\t\t\t\t\t\t<i className='fas fa-plus-circle'></i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</PopoverHeader>\n\t\t\t\t\t\t\t\t<PopoverBody>\n\t\t\t\t\t\t\t\t\t<Emojie\n\t\t\t\t\t\t\t\t\t\thistory={this.props.history}\n\t\t\t\t\t\t\t\t\t\tchatId={this.state.chatId}\n\t\t\t\t\t\t\t\t\t\temojies={this.state.allEmojies}\n\t\t\t\t\t\t\t\t\t\tfunc={this.insertEmojie}></Emojie>\n\t\t\t\t\t\t\t\t</PopoverBody>\n\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t\t<AddEmojie\n\t\t\t\t\t\t\t\topen={this.state.openAddEmojie}\n\t\t\t\t\t\t\t\tcloseAddSticker={\n\t\t\t\t\t\t\t\t\tthis.closeAddSticker\n\t\t\t\t\t\t\t\t}></AddEmojie>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tref='notes'\n\t\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\t\tclassName='form-control'\n\t\t\t\t\t\t\tplaceholder=''\n\t\t\t\t\t\t\taria-label=''\n\t\t\t\t\t\t\taria-describedby='basic-addon1'\n\t\t\t\t\t\t\tstyle={{ resize: 'none' }}\n\t\t\t\t\t\t\tonChange={this.onChangeMessage}></textarea>\n\t\t\t\t\t\t<div className='input-group-append'>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName='btn btn-primary'\n\t\t\t\t\t\t\t\ttype='button'\n\t\t\t\t\t\t\t\tonClick={this.onSendMessage}>\n\t\t\t\t\t\t\t\tОтправить\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcloseAddSticker() {\n\t\tthis.setState({ openAddEmojie: false });\n\t}\n\n\tinsertEmojie(text) {\n\t\tconsole.log(text);\n\t\tvar notes = this.refs.notes;\n\t\tnotes.value += text;\n\t\tthis.setState({ textMessage: notes.value });\n\t}\n\n\tonEmojie = (e) => {\n\t\tconsole.log(e.target);\n\t\tconsole.log(e.target.className);\n\t\tif (\n\t\t\te.target.className === 'fas fa-smile-wink' ||\n\t\t\te.target.className === 'btn btn-light'\n\t\t)\n\t\t\tthis.setState({\n\t\t\t\tshowEmojie: !this.state.showEmojie,\n\t\t\t});\n\t};\n\n\taddSticker = (e) => {\n\t\tthis.setState({ openAddEmojie: true });\n\t};\n\n\tonBack = (e) => {\n\t\tconst { history } = this.props;\n\t\thistory.push('/chats');\n\t};\n\n\tonChangeMessage = (e) => {\n\t\tconsole.log(e.target.value);\n\t\tthis.setState({ textMessage: e.target.value });\n\t};\n\n\tonSendMessage = (e) => {\n\t\tif (this.state.textMessage !== '') {\n\t\t\tconsole.log({\n\t\t\t\ttxt: this.state.textMessage,\n\t\t\t\tchatId: this.state.chatId,\n\t\t\t});\n\t\t\twindow.socket.send(\n\t\t\t\tJSON.stringify({\n\t\t\t\t\ttxt: this.state.textMessage,\n\t\t\t\t\tchatId: this.state.chatId,\n\t\t\t\t}),\n\t\t\t);\n\t\t\tvar notes = this.refs.notes;\n\t\t\tnotes.value = '';\n\t\t\tthis.setState({ textMessage: '' });\n\t\t}\n\t};\n\n\tasync componentDidMount() {\n\t\t// Load async data.\n\t\ttry {\n\t\t\tif (!window.socket) {\n\t\t\t\tawait connectSocket();\n\t\t\t}\n\n\t\t\t// data: \"{\"event\":\"new message\",\"message\":{\"author\":\"poi\",\"txt\":\"sdga\",\"chatName\":\"Snow\",\"chatId\":9,\"emojies\":null}}↵\"\n\t\t\twindow.socket.onmessage = function (event) {\n\t\t\t\tconsole.log('[WS] Message', event);\n\t\t\t\tvar data = JSON.parse(event.data);\n\t\t\t\tconsole.log(data);\n\t\t\t\tconsole.log(data.message);\n\t\t\t\tif (data.message.chatId === this.state.chatId) {\n\t\t\t\t\tlet newMsg = {\n\t\t\t\t\t\tauthor: data.message.author,\n\t\t\t\t\t\ttxt: data.message.txt,\n\t\t\t\t\t\tchatName: data.message.chatName,\n\t\t\t\t\t\tchatId: data.message.chatId,\n\t\t\t\t\t\temojies: data.message.emojies,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tmessages: [newMsg, ...this.state.messages],\n\t\t\t\t\t});\n\t\t\t\t\tconsole.log('[Add msg]');\n\t\t\t\t}\n\t\t\t}.bind(this);\n\n\t\t\tlet mainData = await API.get(`/chats/${this.state.chatId}`, {\n\t\t\t\tparams: {\n\t\t\t\t\tresults: 1,\n\t\t\t\t\tinc: 'chatInfo,messages',\n\t\t\t\t},\n\t\t\t}); // Парсим резульатты.\n\n\t\t\tconsole.log(mainData);\n\n\t\t\tlet chatInfo = mainData.data.chatInfo;\n\t\t\tlet messages = mainData.data.messages;\n\t\t\tlet allEmojies = mainData.data.allEmojies; // Обновляем стейт и ререндерим наш компонент.\n\n\t\t\tconsole.log('[DEBUG]: Chat answer');\n\t\t\tconsole.log(mainData.data);\n\t\t\tthis.setState({\n\t\t\t\t...this.state,\n\t\t\t\t...{\n\t\t\t\t\tchatInfo: chatInfo,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\tallEmojies: allEmojies,\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tconsole.log(`[DEBUG]: /chats/${this.state.chatId} error`);\n\t\t\tconsole.log(err);\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}