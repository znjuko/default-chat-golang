{"ast":null,"code":"var _jsxFileName = \"/home/znjuko/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/rk2/bmstu_front/default-chat-golang/front/src/pages/Messages.js\";\nimport React from 'react';\nimport API from '../utils/API';\nimport connectSocket from '../utils/Socket';\nimport Emojie from '../mixins/emojie';\nimport { Link, useParams } from 'react-router-dom';\nimport Message from '../mixins/Message';\nimport AddEmojie from '../mixins/addEmojie';\nimport { Popover, PopoverBody, PopoverHeader, Button } from 'shards-react';\nexport default class Messages extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onEmojie = e => {\n      console.log(e.target);\n      console.log(e.target.className);\n      if (e.target.className === 'fas fa-smile-wink' || e.target.className === 'btn btn-light') this.setState({\n        showEmojie: !this.state.showEmojie\n      });\n    };\n\n    this.addSticker = e => {\n      this.setState({\n        openAddEmojie: true\n      });\n    };\n\n    this.onBack = e => {\n      const {\n        history\n      } = this.props;\n      history.push('/chats');\n    };\n\n    this.onChangeMessage = e => {\n      this.setState({\n        textMessage: e.target.value\n      });\n    };\n\n    this.onSendMessage = e => {\n      if (this.state.textMessage !== '') {\n        console.log({\n          txt: this.state.textMessage,\n          chatId: this.state.chatId\n        });\n        window.socket.next({\n          txt: this.state.textMessage,\n          chatId: this.state.chatId\n        });\n        var notes = this.refs.notes;\n        notes.value = '';\n        this.setState({\n          textMessage: ''\n        });\n      }\n    };\n\n    const {\n      match: {\n        params\n      }\n    } = this.props;\n    this.insertEmojie = this.insertEmojie.bind(this);\n    this.closeAddSticker = this.closeAddSticker.bind(this);\n    this.state = {\n      chatId: parseInt(params.chatId),\n      chatInfo: {\n        chatName: 'chat'\n      },\n      messages: [],\n      textMessage: '',\n      showEmojie: false,\n      allEmojies: [],\n      openAddEmojie: false\n    };\n  }\n\n  render() {\n    const {\n      history\n    } = this.props;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid flex-column align-items-center h-100 mt-2 d-flex justify-content-between\",\n      style: {\n        minHeight: '90vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"h-100  w-75 d-flex justify-content-center\",\n      style: {\n        height: '20%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"h-100 d-flex justify-content-between align-items-center w-100 border-bottom border-white\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.onBack,\n      activeclassname: \"active\",\n      className: \"d-inline-flex btn btn-outline-info btn-pill\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-undo-alt\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 8\n      }\n    })), /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"h4 mt-2  d-inline-flex\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 7\n      }\n    }, this.state.chatInfo.chatName)), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-75 d-flex justify-content-center position-fixed-bottom mx-auto\",\n      style: {\n        minHeight: '80vh',\n        marginBottom: '80px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(Message, {\n      history: history,\n      messages: this.state.messages,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-75 d-flex justify-content-center fixed-bottom mx-auto\",\n      style: {\n        maxHeight: '20%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-group mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-group-prepend\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-light\",\n      type: \"button\",\n      id: \"emojie\",\n      name: \"emojie\",\n      style: {\n        fontSize: '2rem'\n      },\n      onClick: this.onEmojie,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-smile-wink\",\n      name: \"emojie2\",\n      onClick: this.onEmojie,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Popover, {\n      placement: \"top\",\n      open: this.state.showEmojie,\n      toggle: this.onEmojie,\n      target: \"#emojie\",\n      className: \"overflow-hidden\",\n      style: {\n        minHeight: '400px',\n        minWidth: '280px',\n        maxHeight: '400px',\n        overflowY: 'scroll'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(PopoverHeader, {\n      className: \"d-flex justify-content-between align-items-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }\n    }, \"\\u0421\\u0442\\u0438\\u043A\\u0435\\u0440\\u044B\", /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.addSticker,\n      activeClassName: \"active\",\n      className: \"d-inline-flex btn btn-outline-info btn-pill\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-plus-circle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 11\n      }\n    }))), /*#__PURE__*/React.createElement(PopoverBody, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Emojie, {\n      history: history,\n      chatId: this.state.chatId,\n      emojies: this.state.allEmojies,\n      func: this.insertEmojie,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 10\n      }\n    }))), /*#__PURE__*/React.createElement(AddEmojie, {\n      history: history,\n      chatId: this.state.chatId,\n      open: this.state.openAddEmojie,\n      closeAddSticker: this.closeAddSticker,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 8\n      }\n    })), /*#__PURE__*/React.createElement(\"textarea\", {\n      ref: \"notes\",\n      type: \"text\",\n      className: \"form-control\",\n      placeholder: \"\",\n      \"aria-label\": \"\",\n      \"aria-describedby\": \"basic-addon1\",\n      style: {\n        resize: 'none'\n      },\n      onChange: this.onChangeMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"input-group-append\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      type: \"button\",\n      onClick: this.onSendMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 8\n      }\n    }, \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\")))));\n  }\n\n  closeAddSticker() {\n    this.setState({\n      openAddEmojie: false\n    });\n  }\n\n  insertEmojie(text) {\n    console.log(text);\n    var notes = this.refs.notes;\n    notes.value += text;\n    this.setState({\n      textMessage: notes.value\n    });\n  }\n\n  async componentDidMount() {\n    // Load async data.\n    try {\n      if (!window.socket) {\n        await connectSocket();\n      }\n\n      window.socket.subscribe(val => {\n        if (window.location.pathname === `/chats/${this.state.chatId}`) {\n          val = val.message;\n\n          if (val.chatId === this.state.chatId) {\n            this.setState({\n              messages: [val, ...this.state.messages]\n            });\n          }\n        }\n      }, err => {\n        return console.error('error:', err);\n      }, () => console.log('completed'));\n      let mainData = await API.get(`/chats/${this.state.chatId}`, {\n        params: {\n          results: 1,\n          inc: 'chatInfo,messages'\n        }\n      }); // Парсим резульатты.\n\n      let chatInfo = mainData.data.chatInfo;\n      let messages = mainData.data.messages;\n      let allEmojies = mainData.data.allEmojies; // Обновляем стейт и ререндерим наш компонент.\n\n      this.setState({ ...this.state,\n        ...{\n          chatInfo: chatInfo,\n          messages: messages,\n          allEmojies: allEmojies\n        }\n      });\n    } catch (err) {\n      console.log(`[DEBUG]: /chats/${this.state.chatId} error`);\n      console.log(err);\n    }\n  }\n\n}","map":{"version":3,"sources":["/home/znjuko/Рабочий стол/rk2/bmstu_front/default-chat-golang/front/src/pages/Messages.js"],"names":["React","API","connectSocket","Emojie","Link","useParams","Message","AddEmojie","Popover","PopoverBody","PopoverHeader","Button","Messages","Component","constructor","props","onEmojie","e","console","log","target","className","setState","showEmojie","state","addSticker","openAddEmojie","onBack","history","push","onChangeMessage","textMessage","value","onSendMessage","txt","chatId","window","socket","next","notes","refs","match","params","insertEmojie","bind","closeAddSticker","parseInt","chatInfo","chatName","messages","allEmojies","render","minHeight","height","marginBottom","maxHeight","fontSize","minWidth","overflowY","resize","text","componentDidMount","subscribe","val","location","pathname","message","err","error","mainData","get","results","inc","data"],"mappings":"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","sourcesContent":["import React from 'react';\nimport API from '../utils/API';\nimport connectSocket from '../utils/Socket';\nimport Emojie from '../mixins/emojie';\nimport { Link, useParams } from 'react-router-dom';\nimport Message from '../mixins/Message';\nimport AddEmojie from '../mixins/addEmojie';\n\nimport { Popover, PopoverBody, PopoverHeader, Button } from 'shards-react';\n\nexport default class Messages extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tconst {\n\t\t\tmatch: { params },\n\t\t} = this.props;\n\n\t\tthis.insertEmojie = this.insertEmojie.bind(this);\n\t\tthis.closeAddSticker = this.closeAddSticker.bind(this);\n\t\tthis.state = {\n\t\t\tchatId: parseInt(params.chatId),\n\t\t\tchatInfo: {\n\t\t\t\tchatName: 'chat',\n\t\t\t},\n\t\t\tmessages: [],\n\t\t\ttextMessage: '',\n\t\t\tshowEmojie: false,\n\t\t\tallEmojies: [],\n\t\t\topenAddEmojie: false,\n\t\t};\n\t}\n\n\trender() {\n\t\tconst { history } = this.props;\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName='container-fluid flex-column align-items-center h-100 mt-2 d-flex justify-content-between'\n\t\t\t\tstyle={{ minHeight: '90vh' }}>\n\t\t\t\t<div\n\t\t\t\t\tclassName='h-100  w-75 d-flex justify-content-center'\n\t\t\t\t\tstyle={{ height: '20%' }}>\n\t\t\t\t\t<div className='h-100 d-flex justify-content-between align-items-center w-100 border-bottom border-white'>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={this.onBack}\n\t\t\t\t\t\t\tactiveclassname='active'\n\t\t\t\t\t\t\tclassName='d-inline-flex btn btn-outline-info btn-pill'>\n\t\t\t\t\t\t\t<i className='fas fa-undo-alt'></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<h4 className='h4 mt-2  d-inline-flex'>\n\t\t\t\t\t\t\t{this.state.chatInfo.chatName}\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<hr />\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName='w-75 d-flex justify-content-center position-fixed-bottom mx-auto'\n\t\t\t\t\tstyle={{ minHeight: '80vh', marginBottom: '80px' }}>\n\t\t\t\t\t<Message\n\t\t\t\t\t\thistory={history}\n\t\t\t\t\t\tmessages={this.state.messages}></Message>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName='w-75 d-flex justify-content-center fixed-bottom mx-auto'\n\t\t\t\t\tstyle={{ maxHeight: '20%' }}>\n\t\t\t\t\t<div className='input-group mb-3'>\n\t\t\t\t\t\t<div className='input-group-prepend'>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName='btn btn-light'\n\t\t\t\t\t\t\t\ttype='button'\n\t\t\t\t\t\t\t\tid='emojie'\n\t\t\t\t\t\t\t\tname='emojie'\n\t\t\t\t\t\t\t\tstyle={{ fontSize: '2rem' }}\n\t\t\t\t\t\t\t\tonClick={this.onEmojie}>\n\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\tclassName='fas fa-smile-wink'\n\t\t\t\t\t\t\t\t\tname='emojie2'\n\t\t\t\t\t\t\t\t\tonClick={this.onEmojie}></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\t\tplacement='top'\n\t\t\t\t\t\t\t\topen={this.state.showEmojie}\n\t\t\t\t\t\t\t\ttoggle={this.onEmojie}\n\t\t\t\t\t\t\t\ttarget='#emojie'\n\t\t\t\t\t\t\t\tclassName='overflow-hidden'\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tminHeight: '400px',\n\t\t\t\t\t\t\t\t\tminWidth: '280px',\n\t\t\t\t\t\t\t\t\tmaxHeight: '400px',\n\t\t\t\t\t\t\t\t\toverflowY: 'scroll',\n\t\t\t\t\t\t\t\t}}>\n\t\t\t\t\t\t\t\t<PopoverHeader className='d-flex justify-content-between align-items-center'>\n\t\t\t\t\t\t\t\t\tСтикеры\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonClick={this.addSticker}\n\t\t\t\t\t\t\t\t\t\tactiveClassName='active'\n\t\t\t\t\t\t\t\t\t\tclassName='d-inline-flex btn btn-outline-info btn-pill'>\n\t\t\t\t\t\t\t\t\t\t<i className='fas fa-plus-circle'></i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</PopoverHeader>\n\t\t\t\t\t\t\t\t<PopoverBody>\n\t\t\t\t\t\t\t\t\t<Emojie\n\t\t\t\t\t\t\t\t\t\thistory={history}\n\t\t\t\t\t\t\t\t\t\tchatId={this.state.chatId}\n\t\t\t\t\t\t\t\t\t\temojies={this.state.allEmojies}\n\t\t\t\t\t\t\t\t\t\tfunc={this.insertEmojie}></Emojie>\n\t\t\t\t\t\t\t\t</PopoverBody>\n\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t\t<AddEmojie\n\t\t\t\t\t\t\t\thistory={history}\n\t\t\t\t\t\t\t\tchatId={this.state.chatId}\n\t\t\t\t\t\t\t\topen={this.state.openAddEmojie}\n\t\t\t\t\t\t\t\tcloseAddSticker={\n\t\t\t\t\t\t\t\t\tthis.closeAddSticker\n\t\t\t\t\t\t\t\t}></AddEmojie>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tref='notes'\n\t\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\t\tclassName='form-control'\n\t\t\t\t\t\t\tplaceholder=''\n\t\t\t\t\t\t\taria-label=''\n\t\t\t\t\t\t\taria-describedby='basic-addon1'\n\t\t\t\t\t\t\tstyle={{ resize: 'none' }}\n\t\t\t\t\t\t\tonChange={this.onChangeMessage}></textarea>\n\t\t\t\t\t\t<div className='input-group-append'>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclassName='btn btn-primary'\n\t\t\t\t\t\t\t\ttype='button'\n\t\t\t\t\t\t\t\tonClick={this.onSendMessage}>\n\t\t\t\t\t\t\t\tОтправить\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcloseAddSticker() {\n\t\tthis.setState({ openAddEmojie: false });\n\t}\n\n\tinsertEmojie(text) {\n\t\tconsole.log(text);\n\t\tvar notes = this.refs.notes;\n\t\tnotes.value += text;\n\t\tthis.setState({ textMessage: notes.value });\n\t}\n\n\tonEmojie = (e) => {\n\t\tconsole.log(e.target);\n\t\tconsole.log(e.target.className);\n\t\tif (\n\t\t\te.target.className === 'fas fa-smile-wink' ||\n\t\t\te.target.className === 'btn btn-light'\n\t\t)\n\t\t\tthis.setState({\n\t\t\t\tshowEmojie: !this.state.showEmojie,\n\t\t\t});\n\t};\n\n\taddSticker = (e) => {\n\t\tthis.setState({ openAddEmojie: true });\n\t};\n\n\tonBack = (e) => {\n\t\tconst { history } = this.props;\n\t\thistory.push('/chats');\n\t};\n\n\tonChangeMessage = (e) => {\n\t\tthis.setState({ textMessage: e.target.value });\n\t};\n\n\tonSendMessage = (e) => {\n\t\tif (this.state.textMessage !== '') {\n\t\t\tconsole.log({\n\t\t\t\ttxt: this.state.textMessage,\n\t\t\t\tchatId: this.state.chatId,\n\t\t\t});\n\t\t\twindow.socket.next({\n\t\t\t\ttxt: this.state.textMessage,\n\t\t\t\tchatId: this.state.chatId,\n\t\t\t});\n\t\t\tvar notes = this.refs.notes;\n\t\t\tnotes.value = '';\n\t\t\tthis.setState({ textMessage: '' });\n\t\t}\n\t};\n\n\tasync componentDidMount() {\n\t\t// Load async data.\n\t\ttry {\n\t\t\tif (!window.socket) {\n\t\t\t\tawait connectSocket();\n\t\t\t}\n\n\t\t\twindow.socket.subscribe(\n\t\t\t\t(val) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\twindow.location.pathname ===\n\t\t\t\t\t\t`/chats/${this.state.chatId}`\n\t\t\t\t\t) {\n\t\t\t\t\t\tval = val.message;\n\t\t\t\t\t\tif (val.chatId === this.state.chatId) {\n\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\tmessages: [val, ...this.state.messages],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(err) => {\n\t\t\t\t\treturn console.error('error:', err);\n\t\t\t\t},\n\t\t\t\t() => console.log('completed'),\n\t\t\t);\n\n\t\t\tlet mainData = await API.get(`/chats/${this.state.chatId}`, {\n\t\t\t\tparams: {\n\t\t\t\t\tresults: 1,\n\t\t\t\t\tinc: 'chatInfo,messages',\n\t\t\t\t},\n\t\t\t}); // Парсим резульатты.\n\n\t\t\tlet chatInfo = mainData.data.chatInfo;\n\t\t\tlet messages = mainData.data.messages;\n\t\t\tlet allEmojies = mainData.data.allEmojies; // Обновляем стейт и ререндерим наш компонент.\n\t\t\tthis.setState({\n\t\t\t\t...this.state,\n\t\t\t\t...{\n\t\t\t\t\tchatInfo: chatInfo,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\tallEmojies: allEmojies,\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tconsole.log(`[DEBUG]: /chats/${this.state.chatId} error`);\n\t\t\tconsole.log(err);\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}