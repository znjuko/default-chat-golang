{"ast":null,"code":"var _jsxFileName = \"/home/znjuko/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/rk2/bmstu_front/default-chat-golang/front/src/pages/Messanger.js\";\nimport React from 'react';\nimport API from '../utils/API';\nimport OnlineUsers from './OnlineUsers';\nimport Chats from './Chats';\nimport connectSocket from '../utils/Socket';\nimport { Button, Modal, ModalBody, ModalHeader, FormTextarea, Form } from 'shards-react';\nexport default class Messanger extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = e => {\n      this.setState({\n        txt: e.target.value\n      });\n    };\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      const {\n        txt\n      } = this.state;\n\n      try {\n        await API.post('/all', {\n          txt\n        });\n        this.setState({\n          open: false\n        });\n      } catch (err) {\n        console.log('[DEBUG]: error while all');\n        console.log(err);\n      }\n    };\n\n    this.onBack = async () => {\n      try {\n        await API.delete('/login');\n        window.socket.complete();\n        this.props.history.push('/login');\n      } catch (err) {\n        console.log('[DEBUG]: error while delete');\n        console.log(err);\n      }\n    };\n\n    this.openSendToAll = () => {\n      this.setState({\n        open: !this.state.open\n      });\n    };\n\n    this.toggle = this.toggle.bind(this);\n    this.state = {\n      isLoading: true,\n      chats: [],\n      online: [],\n      open: false,\n      txt: ''\n    };\n  }\n\n  render() {\n    const {\n      history\n    } = this.props;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid h-100 mt-2\",\n      style: {\n        minHeight: '90vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 32,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row h-100 d-flex justify-content-center\",\n      style: {\n        minHeight: '100vh'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-between\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"h4 mt-2 text-left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 8\n      }\n    }, \"\\u0412\\u0430\\u0448\\u0438 \\u0447\\u0430\\u0442\\u044B\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.onBack,\n      activeclassname: \"active\",\n      className: \"d-inline-flex btn btn-danger btn-pill\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fas fa-frown\",\n      style: {\n        fontSize: '1.5rem'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 9\n      }\n    }))), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(Chats, {\n      history: history,\n      chats: this.state.chats,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 7\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col col-md-3 \",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 54,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"h4 mt-2 text-left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55,\n        columnNumber: 7\n      }\n    }, \"\\u041F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0438 \\u043E\\u043D\\u043B\\u0430\\u0439\\u043D\"), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      theme: \"info\",\n      onClick: this.openSendToAll,\n      activeclassname: \"active\",\n      className: \"w-100\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"lead mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 8\n      }\n    }, \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435 \\u0432\\u0441\\u0435\\u043C\")), /*#__PURE__*/React.createElement(Modal, {\n      open: this.state.open,\n      toggle: this.toggle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ModalHeader, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 8\n      }\n    }, \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0434\\u043B\\u044F \\u0432\\u0441\\u0435\\u0445 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\"), /*#__PURE__*/React.createElement(ModalBody, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormTextarea, {\n      className: \"mb-4\",\n      placeholder: \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0432\\u0430\\u0448\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",\n      rows: \"10\",\n      onChange: this.handleChange,\n      style: {\n        resize: 'none'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 10\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      className: \"mt-1 w-100\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 10\n      }\n    }, \"\\uD83D\\uDC49\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\uD83D\\uDC48\")))), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(OnlineUsers, {\n      history: history,\n      online: this.state.online,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 7\n      }\n    }))));\n  }\n\n  toggle() {\n    this.setState({\n      open: !this.state.open\n    });\n  }\n\n  async componentDidMount() {\n    // Load async data.\n    try {\n      if (!window.socket) {\n        await connectSocket();\n      }\n\n      window.socket.subscribe(val => {\n        if (val.event === 'online') {\n          if (window.location.pathname === '/chats') {\n            val = val.online;\n            console.log(val);\n            this.setState({\n              online: val\n            });\n          }\n        } else if (val.event === 'new message') {\n          if (window.location.pathname === '/chats') {\n            this.props.history.push('/');\n          }\n        }\n      }, err => {\n        return console.error('error:', err);\n      }, () => console.log('completed'));\n      let mainData = await API.get('/chats', {\n        params: {\n          results: 1,\n          inc: 'chats,online'\n        }\n      }); // Парсим резульатты.\n\n      console.log(mainData);\n      let chatsData = mainData.data.chats;\n      let onlineData = mainData.data.online; // Обновляем стейт и ререндерим наш компонент.\n\n      this.setState({ ...this.state,\n        ...{\n          isLoading: false,\n          chats: chatsData,\n          online: onlineData\n        }\n      });\n    } catch (err) {\n      console.log('[DEBUG]: /chats error');\n      console.log(err);\n      this.props.history.push('/login');\n    }\n  }\n\n}","map":{"version":3,"sources":["/home/znjuko/Рабочий стол/rk2/bmstu_front/default-chat-golang/front/src/pages/Messanger.js"],"names":["React","API","OnlineUsers","Chats","connectSocket","Button","Modal","ModalBody","ModalHeader","FormTextarea","Form","Messanger","Component","constructor","props","handleChange","e","setState","txt","target","value","handleSubmit","preventDefault","state","post","open","err","console","log","onBack","delete","window","socket","complete","history","push","openSendToAll","toggle","bind","isLoading","chats","online","render","minHeight","fontSize","resize","componentDidMount","subscribe","val","event","location","pathname","error","mainData","get","params","results","inc","chatsData","data","onlineData"],"mappings":"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","sourcesContent":["import React from 'react';\nimport API from '../utils/API';\n\nimport OnlineUsers from './OnlineUsers';\nimport Chats from './Chats';\nimport connectSocket from '../utils/Socket';\nimport {\n\tButton,\n\tModal,\n\tModalBody,\n\tModalHeader,\n\tFormTextarea,\n\tForm,\n} from 'shards-react';\n\nexport default class Messanger extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.toggle = this.toggle.bind(this);\n\t\tthis.state = {\n\t\t\tisLoading: true,\n\t\t\tchats: [],\n\t\t\tonline: [],\n\t\t\topen: false,\n\t\t\ttxt: '',\n\t\t};\n\t}\n\n\trender() {\n\t\tconst { history } = this.props;\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName='container-fluid h-100 mt-2'\n\t\t\t\tstyle={{ minHeight: '90vh' }}>\n\t\t\t\t<div\n\t\t\t\t\tclassName='row h-100 d-flex justify-content-center'\n\t\t\t\t\tstyle={{ minHeight: '100vh' }}>\n\t\t\t\t\t<div className='col-md-6'>\n\t\t\t\t\t\t<div className='d-flex justify-content-between'>\n\t\t\t\t\t\t\t<h4 className='h4 mt-2 text-left'>Ваши чаты</h4>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={this.onBack}\n\t\t\t\t\t\t\t\tactiveclassname='active'\n\t\t\t\t\t\t\t\tclassName='d-inline-flex btn btn-danger btn-pill'>\n\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\tclassName='fas fa-frown'\n\t\t\t\t\t\t\t\t\tstyle={{ fontSize: '1.5rem' }}></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<Chats history={history} chats={this.state.chats} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className='col col-md-3 '>\n\t\t\t\t\t\t<h4 className='h4 mt-2 text-left'>\n\t\t\t\t\t\t\tПользователи онлайн\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttheme='info'\n\t\t\t\t\t\t\tonClick={this.openSendToAll}\n\t\t\t\t\t\t\tactiveclassname='active'\n\t\t\t\t\t\t\tclassName='w-100'>\n\t\t\t\t\t\t\t<p className='lead mb-0'>\n\t\t\t\t\t\t\t\tОтправить сообщение всем\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Modal open={this.state.open} toggle={this.toggle}>\n\t\t\t\t\t\t\t<ModalHeader>\n\t\t\t\t\t\t\t\tВведите для всех сообщение\n\t\t\t\t\t\t\t</ModalHeader>\n\t\t\t\t\t\t\t<ModalBody>\n\t\t\t\t\t\t\t\t<Form onSubmit={this.handleSubmit}>\n\t\t\t\t\t\t\t\t\t<FormTextarea\n\t\t\t\t\t\t\t\t\t\tclassName='mb-4'\n\t\t\t\t\t\t\t\t\t\tplaceholder='Введите ваше сообщение'\n\t\t\t\t\t\t\t\t\t\trows='10'\n\t\t\t\t\t\t\t\t\t\tonChange={this.handleChange}\n\t\t\t\t\t\t\t\t\t\tstyle={{ resize: 'none' }}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\ttype='submit'\n\t\t\t\t\t\t\t\t\t\tclassName='mt-1 w-100'>\n\t\t\t\t\t\t\t\t\t\t👉Отправить 👈\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</Form>\n\t\t\t\t\t\t\t</ModalBody>\n\t\t\t\t\t\t</Modal>\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<OnlineUsers\n\t\t\t\t\t\t\thistory={history}\n\t\t\t\t\t\t\tonline={this.state.online}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\thandleChange = (e) => {\n\t\tthis.setState({ txt: e.target.value });\n\t};\n\thandleSubmit = async (e) => {\n\t\te.preventDefault();\n\t\tconst { txt } = this.state;\n\t\ttry {\n\t\t\tawait API.post('/all', { txt });\n\t\t\tthis.setState({ open: false });\n\t\t} catch (err) {\n\t\t\tconsole.log('[DEBUG]: error while all');\n\t\t\tconsole.log(err);\n\t\t}\n\t};\n\n\tonBack = async () => {\n\t\ttry {\n\t\t\tawait API.delete('/login');\n\t\t\twindow.socket.complete();\n\t\t\tthis.props.history.push('/login');\n\t\t} catch (err) {\n\t\t\tconsole.log('[DEBUG]: error while delete');\n\t\t\tconsole.log(err);\n\t\t}\n\t};\n\n\ttoggle() {\n\t\tthis.setState({\n\t\t\topen: !this.state.open,\n\t\t});\n\t}\n\n\topenSendToAll = () => {\n\t\tthis.setState({\n\t\t\topen: !this.state.open,\n\t\t});\n\t};\n\n\tasync componentDidMount() {\n\t\t// Load async data.\n\t\ttry {\n\t\t\tif (!window.socket) {\n\t\t\t\tawait connectSocket();\n\t\t\t}\n\n\t\t\twindow.socket.subscribe(\n\t\t\t\t(val) => {\n\t\t\t\t\tif (val.event === 'online') {\n\t\t\t\t\t\tif (window.location.pathname === '/chats') {\n\t\t\t\t\t\t\tval = val.online;\n\t\t\t\t\t\t\tconsole.log(val);\n\t\t\t\t\t\t\tthis.setState({ online: val });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (val.event === 'new message') {\n\t\t\t\t\t\tif (window.location.pathname === '/chats') {\n\t\t\t\t\t\t\tthis.props.history.push('/');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(err) => {\n\t\t\t\t\treturn console.error('error:', err);\n\t\t\t\t},\n\t\t\t\t() => console.log('completed'),\n\t\t\t);\n\n\t\t\tlet mainData = await API.get('/chats', {\n\t\t\t\tparams: {\n\t\t\t\t\tresults: 1,\n\t\t\t\t\tinc: 'chats,online',\n\t\t\t\t},\n\t\t\t}); // Парсим резульатты.\n\n\t\t\tconsole.log(mainData);\n\n\t\t\tlet chatsData = mainData.data.chats;\n\t\t\tlet onlineData = mainData.data.online; // Обновляем стейт и ререндерим наш компонент.\n\n\t\t\tthis.setState({\n\t\t\t\t...this.state,\n\t\t\t\t...{\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\tchats: chatsData,\n\t\t\t\t\tonline: onlineData,\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tconsole.log('[DEBUG]: /chats error');\n\t\t\tconsole.log(err);\n\t\t\tthis.props.history.push('/login');\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}