{"ast":null,"code":"import { RouteNode } from 'route-node';\nexport { RouteNode } from 'route-node';\nimport $$observable from 'symbol-observable';\nimport transitionPath, { nameToIDs } from 'router5-transition-path';\nexport { default as transitionPath } from 'router5-transition-path';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar defaultOptions = {\n  trailingSlashMode: 'default',\n  queryParamsMode: 'default',\n  strictTrailingSlash: false,\n  autoCleanUp: true,\n  allowNotFound: false,\n  strongMatching: true,\n  rewritePathOnMatch: true,\n  caseSensitive: false,\n  urlParamsEncoding: 'default'\n};\n\nfunction withOptions(options) {\n  return function (router) {\n    var routerOptions = __assign(__assign({}, defaultOptions), options);\n\n    router.getOptions = function () {\n      return routerOptions;\n    };\n\n    router.setOption = function (option, value) {\n      routerOptions[option] = value;\n      return router;\n    };\n\n    return router;\n  };\n}\n\nvar errorCodes = {\n  ROUTER_NOT_STARTED: 'NOT_STARTED',\n  NO_START_PATH_OR_STATE: 'NO_START_PATH_OR_STATE',\n  ROUTER_ALREADY_STARTED: 'ALREADY_STARTED',\n  ROUTE_NOT_FOUND: 'ROUTE_NOT_FOUND',\n  SAME_STATES: 'SAME_STATES',\n  CANNOT_DEACTIVATE: 'CANNOT_DEACTIVATE',\n  CANNOT_ACTIVATE: 'CANNOT_ACTIVATE',\n  TRANSITION_ERR: 'TRANSITION_ERR',\n  TRANSITION_CANCELLED: 'CANCELLED'\n};\nvar constants = {\n  UNKNOWN_ROUTE: '@@router5/UNKNOWN_ROUTE',\n  ROUTER_START: '$start',\n  ROUTER_STOP: '$stop',\n  TRANSITION_START: '$$start',\n  TRANSITION_CANCEL: '$$cancel',\n  TRANSITION_SUCCESS: '$$success',\n  TRANSITION_ERROR: '$$error'\n};\n\nfunction withRoutes(routes) {\n  return function (router) {\n    router.forward = function (fromRoute, toRoute) {\n      router.config.forwardMap[fromRoute] = toRoute;\n      return router;\n    };\n\n    var rootNode = routes instanceof RouteNode ? routes : new RouteNode('', '', routes, {\n      onAdd: onRouteAdded\n    });\n\n    function onRouteAdded(route) {\n      if (route.canActivate) router.canActivate(route.name, route.canActivate);\n      if (route.forwardTo) router.forward(route.name, route.forwardTo);\n      if (route.decodeParams) router.config.decoders[route.name] = route.decodeParams;\n      if (route.encodeParams) router.config.encoders[route.name] = route.encodeParams;\n      if (route.defaultParams) router.config.defaultParams[route.name] = route.defaultParams;\n    }\n\n    router.rootNode = rootNode;\n\n    router.add = function (routes, finalSort) {\n      rootNode.add(routes, onRouteAdded, !finalSort);\n\n      if (finalSort) {\n        rootNode.sortDescendants();\n      }\n\n      return router;\n    };\n\n    router.addNode = function (name, path, canActivateHandler) {\n      rootNode.addNode(name, path);\n      if (canActivateHandler) router.canActivate(name, canActivateHandler);\n      return router;\n    };\n\n    router.isActive = function (name, params, strictEquality, ignoreQueryParams) {\n      if (params === void 0) {\n        params = {};\n      }\n\n      if (strictEquality === void 0) {\n        strictEquality = false;\n      }\n\n      if (ignoreQueryParams === void 0) {\n        ignoreQueryParams = true;\n      }\n\n      var activeState = router.getState();\n      if (!activeState) return false;\n\n      if (strictEquality || activeState.name === name) {\n        return router.areStatesEqual(router.makeState(name, params), activeState, ignoreQueryParams);\n      }\n\n      return router.areStatesDescendants(router.makeState(name, params), activeState);\n    };\n\n    router.buildPath = function (route, params) {\n      if (route === constants.UNKNOWN_ROUTE) {\n        return params.path;\n      }\n\n      var paramsWithDefault = __assign(__assign({}, router.config.defaultParams[route]), params);\n\n      var _a = router.getOptions(),\n          trailingSlashMode = _a.trailingSlashMode,\n          queryParamsMode = _a.queryParamsMode,\n          queryParams = _a.queryParams;\n\n      var encodedParams = router.config.encoders[route] ? router.config.encoders[route](paramsWithDefault) : paramsWithDefault;\n      return router.rootNode.buildPath(route, encodedParams, {\n        trailingSlashMode: trailingSlashMode,\n        queryParamsMode: queryParamsMode,\n        queryParams: queryParams,\n        urlParamsEncoding: router.getOptions().urlParamsEncoding\n      });\n    };\n\n    router.matchPath = function (path, source) {\n      var options = router.getOptions();\n      var match = router.rootNode.matchPath(path, options);\n\n      if (match) {\n        var name_1 = match.name,\n            params = match.params,\n            meta = match.meta;\n        var decodedParams = router.config.decoders[name_1] ? router.config.decoders[name_1](params) : params;\n\n        var _a = router.forwardState(name_1, decodedParams),\n            routeName = _a.name,\n            routeParams = _a.params;\n\n        var builtPath = options.rewritePathOnMatch === false ? path : router.buildPath(routeName, routeParams);\n        return router.makeState(routeName, routeParams, builtPath, {\n          params: meta,\n          source: source\n        });\n      }\n\n      return null;\n    };\n\n    router.setRootPath = function (rootPath) {\n      router.rootNode.setPath(rootPath);\n    };\n\n    return router;\n  };\n}\n\nfunction withDependencies(dependencies) {\n  return function (router) {\n    var routerDependencies = dependencies;\n\n    router.setDependency = function (dependencyName, dependency) {\n      routerDependencies[dependencyName] = dependency;\n      return router;\n    };\n\n    router.setDependencies = function (deps) {\n      Object.keys(deps).forEach(function (name) {\n        return router.setDependency(name, deps[name]);\n      });\n      return router;\n    };\n\n    router.getDependencies = function () {\n      return routerDependencies;\n    };\n\n    router.getInjectables = function () {\n      return [router, router.getDependencies()];\n    };\n\n    router.executeFactory = function (factoryFunction) {\n      return factoryFunction.apply(void 0, router.getInjectables());\n    };\n\n    return router;\n  };\n}\n\nfunction withState(router) {\n  var stateId = 0;\n  var routerState = null;\n\n  router.getState = function () {\n    return routerState;\n  };\n\n  router.setState = function (state) {\n    routerState = state;\n  };\n\n  router.makeState = function (name, params, path, meta, forceId) {\n    return {\n      name: name,\n      params: __assign(__assign({}, router.config.defaultParams[name]), params),\n      path: path,\n      meta: meta ? __assign(__assign({}, meta), {\n        id: forceId === undefined ? ++stateId : forceId\n      }) : undefined\n    };\n  };\n\n  router.makeNotFoundState = function (path, options) {\n    return router.makeState(constants.UNKNOWN_ROUTE, {\n      path: path\n    }, path, {\n      options: options\n    });\n  };\n\n  router.areStatesEqual = function (state1, state2, ignoreQueryParams) {\n    if (ignoreQueryParams === void 0) {\n      ignoreQueryParams = true;\n    }\n\n    if (state1.name !== state2.name) return false;\n\n    var getUrlParams = function (name) {\n      return router.rootNode //@ts-ignore\n      .getSegmentsByName(name).map(function (segment) {\n        return segment.parser['urlParams'];\n      }).reduce(function (params, p) {\n        return params.concat(p);\n      }, []);\n    };\n\n    var state1Params = ignoreQueryParams ? getUrlParams(state1.name) : Object.keys(state1.params);\n    var state2Params = ignoreQueryParams ? getUrlParams(state2.name) : Object.keys(state2.params);\n    return state1Params.length === state2Params.length && state1Params.every(function (p) {\n      return state1.params[p] === state2.params[p];\n    });\n  };\n\n  router.areStatesDescendants = function (parentState, childState) {\n    var regex = new RegExp('^' + parentState.name + '\\\\.(.*)$');\n    if (!regex.test(childState.name)) return false; // If child state name extends parent state name, and all parent state params\n    // are in child state params.\n\n    return Object.keys(parentState.params).every(function (p) {\n      return parentState.params[p] === childState.params[p];\n    });\n  };\n\n  router.forwardState = function (routeName, routeParams) {\n    var name = router.config.forwardMap[routeName] || routeName;\n\n    var params = __assign(__assign(__assign({}, router.config.defaultParams[routeName]), router.config.defaultParams[name]), routeParams);\n\n    return {\n      name: name,\n      params: params\n    };\n  };\n\n  router.buildState = function (routeName, routeParams) {\n    var _a = router.forwardState(routeName, routeParams),\n        name = _a.name,\n        params = _a.params;\n\n    return router.rootNode.buildState(name, params);\n  };\n\n  return router;\n}\n\nvar eventsMap = {\n  onStart: constants.ROUTER_START,\n  onStop: constants.ROUTER_STOP,\n  onTransitionSuccess: constants.TRANSITION_SUCCESS,\n  onTransitionStart: constants.TRANSITION_START,\n  onTransitionError: constants.TRANSITION_ERROR,\n  onTransitionCancel: constants.TRANSITION_CANCEL\n};\n\nfunction withPlugins(router) {\n  var routerPlugins = [];\n\n  router.getPlugins = function () {\n    return routerPlugins;\n  };\n\n  router.usePlugin = function () {\n    var plugins = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      plugins[_i] = arguments[_i];\n    }\n\n    var removePluginFns = plugins.map(function (plugin) {\n      routerPlugins.push(plugin);\n      return startPlugin(plugin);\n    });\n    return function () {\n      routerPlugins = routerPlugins.filter(function (plugin) {\n        return plugins.indexOf(plugin) === -1;\n      });\n      removePluginFns.forEach(function (removePlugin) {\n        return removePlugin();\n      });\n    };\n  };\n\n  function startPlugin(plugin) {\n    var appliedPlugin = router.executeFactory(plugin);\n    var removeEventListeners = Object.keys(eventsMap).map(function (methodName) {\n      if (appliedPlugin[methodName]) {\n        return router.addEventListener(eventsMap[methodName], appliedPlugin[methodName]);\n      }\n    }).filter(Boolean);\n    return function () {\n      removeEventListeners.forEach(function (removeListener) {\n        return removeListener();\n      });\n\n      if (appliedPlugin.teardown) {\n        appliedPlugin.teardown();\n      }\n    };\n  }\n\n  return router;\n}\n\nfunction withMiddleware(router) {\n  var middlewareFactories = [];\n  var middlewareFunctions = [];\n\n  router.useMiddleware = function () {\n    var middlewares = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      middlewares[_i] = arguments[_i];\n    }\n\n    var removePluginFns = middlewares.map(function (middleware) {\n      var middlewareFunction = router.executeFactory(middleware);\n      middlewareFactories.push(middleware);\n      middlewareFunctions.push(middlewareFunction);\n      return function () {\n        middlewareFactories = middlewareFactories.filter(function (m) {\n          return m !== middleware;\n        });\n        middlewareFunctions = middlewareFunctions.filter(function (m) {\n          return m !== middlewareFunction;\n        });\n      };\n    });\n    return function () {\n      return removePluginFns.forEach(function (fn) {\n        return fn();\n      });\n    };\n  };\n\n  router.clearMiddleware = function () {\n    middlewareFactories = [];\n    middlewareFunctions = [];\n    return router;\n  };\n\n  router.getMiddlewareFactories = function () {\n    return middlewareFactories;\n  };\n\n  router.getMiddlewareFunctions = function () {\n    return middlewareFunctions;\n  };\n\n  return router;\n}\n\nfunction withObservability(router) {\n  var callbacks = {};\n\n  router.invokeEventListeners = function (eventName) {\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    (callbacks[eventName] || []).forEach(function (cb) {\n      return cb.apply(void 0, args);\n    });\n  };\n\n  router.removeEventListener = function (eventName, cb) {\n    callbacks[eventName] = callbacks[eventName].filter(function (_cb) {\n      return _cb !== cb;\n    });\n  };\n\n  router.addEventListener = function (eventName, cb) {\n    callbacks[eventName] = (callbacks[eventName] || []).concat(cb);\n    return function () {\n      return router.removeEventListener(eventName, cb);\n    };\n  };\n\n  function subscribe(listener) {\n    var isObject = typeof listener === 'object';\n    var finalListener = isObject ? listener.next.bind(listener) : listener;\n    var unsubscribeHandler = router.addEventListener(constants.TRANSITION_SUCCESS, function (toState, fromState) {\n      finalListener({\n        route: toState,\n        previousRoute: fromState\n      });\n    });\n    return isObject ? {\n      unsubscribe: unsubscribeHandler\n    } : unsubscribeHandler;\n  }\n\n  function observable() {\n    var _a;\n\n    return _a = {\n      subscribe: function (observer) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new TypeError('Expected the observer to be an object.');\n        }\n\n        return subscribe(observer);\n      }\n    }, _a[$$observable] = function () {\n      return this;\n    }, _a;\n  }\n\n  router.subscribe = subscribe; //@ts-ignore\n\n  router[$$observable] = observable; //@ts-ignore\n\n  router['@@observable'] = observable;\n  return router;\n}\n\nfunction resolve(functions, _a, callback) {\n  var isCancelled = _a.isCancelled,\n      toState = _a.toState,\n      fromState = _a.fromState,\n      _b = _a.errorKey,\n      errorKey = _b === void 0 ? undefined : _b;\n  var remainingFunctions = Array.isArray(functions) ? functions : Object.keys(functions);\n\n  var isState = function (obj) {\n    return typeof obj === 'object' && obj.name !== undefined && obj.params !== undefined && obj.path !== undefined;\n  };\n\n  var hasStateChanged = function (toState, fromState) {\n    return fromState.name !== toState.name || fromState.params !== toState.params || fromState.path !== toState.path;\n  };\n\n  var mergeStates = function (toState, fromState) {\n    return __assign(__assign(__assign({}, fromState), toState), {\n      meta: __assign(__assign({}, fromState.meta), toState.meta)\n    });\n  };\n\n  var processFn = function (stepFn, errBase, state, _done) {\n    var done = function (err, newState) {\n      if (err) {\n        _done(err);\n      } else if (newState && newState !== state && isState(newState)) {\n        if (hasStateChanged(newState, state)) {\n          console.error('[router5][transition] Warning: state values (name, params, path) were changed during transition process.');\n        }\n\n        _done(null, mergeStates(newState, state));\n      } else {\n        _done(null, state);\n      }\n    };\n\n    var res = stepFn.call(null, state, fromState, done);\n\n    if (isCancelled()) {\n      done(null);\n    } else if (typeof res === 'boolean') {\n      done(res ? null : errBase);\n    } else if (isState(res)) {\n      done(null, res);\n    } else if (res && typeof res.then === 'function') {\n      res.then(function (resVal) {\n        if (resVal instanceof Error) done({\n          error: resVal\n        }, null);else done(null, resVal);\n      }, function (err) {\n        if (err instanceof Error) {\n          console.error(err.stack || err);\n          done(__assign(__assign({}, errBase), {\n            promiseError: err\n          }), null);\n        } else {\n          done(typeof err === 'object' ? __assign(__assign({}, errBase), err) : errBase, null);\n        }\n      });\n    } // else: wait for done to be called\n\n  };\n\n  var next = function (err, state) {\n    var _a;\n\n    if (isCancelled()) {\n      callback();\n    } else if (err) {\n      callback(err);\n    } else {\n      if (!remainingFunctions.length) {\n        callback(null, state);\n      } else {\n        var isMapped = typeof remainingFunctions[0] === 'string';\n        var errBase = errorKey && isMapped ? (_a = {}, _a[errorKey] = remainingFunctions[0], _a) : {};\n        var stepFn = isMapped ? functions[remainingFunctions[0]] : remainingFunctions[0];\n        remainingFunctions = remainingFunctions.slice(1);\n        processFn(stepFn, errBase, state, next);\n      }\n    }\n  };\n\n  next(null, toState);\n}\n\nfunction transition(router, toState, fromState, opts, callback) {\n  var cancelled = false;\n  var completed = false;\n  var options = router.getOptions();\n\n  var _a = router.getLifecycleFunctions(),\n      canDeactivateFunctions = _a[0],\n      canActivateFunctions = _a[1];\n\n  var middlewareFunctions = router.getMiddlewareFunctions();\n\n  var isCancelled = function () {\n    return cancelled;\n  };\n\n  var cancel = function () {\n    if (!cancelled && !completed) {\n      cancelled = true;\n      callback({\n        code: errorCodes.TRANSITION_CANCELLED\n      }, null);\n    }\n  };\n\n  var done = function (err, state) {\n    completed = true;\n\n    if (isCancelled()) {\n      return;\n    }\n\n    if (!err && options.autoCleanUp) {\n      var activeSegments_1 = nameToIDs(toState.name);\n      Object.keys(canDeactivateFunctions).forEach(function (name) {\n        if (activeSegments_1.indexOf(name) === -1) router.clearCanDeactivate(name);\n      });\n    }\n\n    callback(err, state || toState);\n  };\n\n  var makeError = function (base, err) {\n    return __assign(__assign({}, base), err instanceof Object ? err : {\n      error: err\n    });\n  };\n\n  var isUnknownRoute = toState.name === constants.UNKNOWN_ROUTE;\n  var asyncBase = {\n    isCancelled: isCancelled,\n    toState: toState,\n    fromState: fromState\n  };\n\n  var _b = transitionPath(toState, fromState),\n      toDeactivate = _b.toDeactivate,\n      toActivate = _b.toActivate;\n\n  var canDeactivate = !fromState || opts.forceDeactivate ? [] : function (toState, fromState, cb) {\n    var canDeactivateFunctionMap = toDeactivate.filter(function (name) {\n      return canDeactivateFunctions[name];\n    }).reduce(function (fnMap, name) {\n      var _a;\n\n      return __assign(__assign({}, fnMap), (_a = {}, _a[name] = canDeactivateFunctions[name], _a));\n    }, {});\n    resolve(canDeactivateFunctionMap, __assign(__assign({}, asyncBase), {\n      errorKey: 'segment'\n    }), function (err) {\n      return cb(err ? makeError({\n        code: errorCodes.CANNOT_DEACTIVATE\n      }, err) : null);\n    });\n  };\n  var canActivate = isUnknownRoute ? [] : function (toState, fromState, cb) {\n    var canActivateFunctionMap = toActivate.filter(function (name) {\n      return canActivateFunctions[name];\n    }).reduce(function (fnMap, name) {\n      var _a;\n\n      return __assign(__assign({}, fnMap), (_a = {}, _a[name] = canActivateFunctions[name], _a));\n    }, {});\n    resolve(canActivateFunctionMap, __assign(__assign({}, asyncBase), {\n      errorKey: 'segment'\n    }), function (err) {\n      return cb(err ? makeError({\n        code: errorCodes.CANNOT_ACTIVATE\n      }, err) : null);\n    });\n  };\n  var middleware = !middlewareFunctions.length ? [] : function (toState, fromState, cb) {\n    return resolve(middlewareFunctions, __assign({}, asyncBase), function (err, state) {\n      return cb(err ? makeError({\n        code: errorCodes.TRANSITION_ERR\n      }, err) : null, state || toState);\n    });\n  };\n  var pipeline = [].concat(canDeactivate).concat(canActivate).concat(middleware);\n  resolve(pipeline, asyncBase, done);\n  return cancel;\n}\n\nvar noop = function () {};\n\nfunction withNavigation(router) {\n  var cancelCurrentTransition;\n  router.navigate = navigate;\n  router.navigate = navigate;\n\n  router.navigateToDefault = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    var opts = typeof args[0] === 'object' ? args[0] : {};\n    var done = args.length === 2 ? args[1] : typeof args[0] === 'function' ? args[0] : noop;\n    var options = router.getOptions();\n\n    if (options.defaultRoute) {\n      return navigate(options.defaultRoute, options.defaultParams, opts, done);\n    }\n\n    return function () {};\n  };\n\n  router.cancel = function () {\n    if (cancelCurrentTransition) {\n      cancelCurrentTransition('navigate');\n      cancelCurrentTransition = null;\n    }\n\n    return router;\n  };\n\n  function navigate() {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    var name = args[0];\n    var lastArg = args[args.length - 1];\n    var done = typeof lastArg === 'function' ? lastArg : noop;\n    var params = typeof args[1] === 'object' ? args[1] : {};\n    var opts = typeof args[2] === 'object' ? args[2] : {};\n\n    if (!router.isStarted()) {\n      done({\n        code: errorCodes.ROUTER_NOT_STARTED\n      });\n      return;\n    }\n\n    var route = router.buildState(name, params);\n\n    if (!route) {\n      var err = {\n        code: errorCodes.ROUTE_NOT_FOUND\n      };\n      done(err);\n      router.invokeEventListeners(constants.TRANSITION_ERROR, null, router.getState(), err);\n      return;\n    }\n\n    var toState = router.makeState(route.name, route.params, router.buildPath(route.name, route.params), {\n      params: route.meta,\n      options: opts\n    });\n    var sameStates = router.getState() ? router.areStatesEqual(router.getState(), toState, false) : false; // Do not proceed further if states are the same and no reload\n    // (no deactivation and no callbacks)\n\n    if (sameStates && !opts.reload && !opts.force) {\n      var err = {\n        code: errorCodes.SAME_STATES\n      };\n      done(err);\n      router.invokeEventListeners(constants.TRANSITION_ERROR, toState, router.getState(), err);\n      return;\n    }\n\n    var fromState = router.getState();\n\n    if (opts.skipTransition) {\n      done(null, toState);\n      return noop;\n    } // Transition\n\n\n    return router.transitionToState(toState, fromState, opts, function (err, state) {\n      if (err) {\n        if (err.redirect) {\n          var _a = err.redirect,\n              name_1 = _a.name,\n              params_1 = _a.params;\n          navigate(name_1, params_1, __assign(__assign({}, opts), {\n            force: true,\n            redirected: true\n          }), done);\n        } else {\n          done(err);\n        }\n      } else {\n        router.invokeEventListeners(constants.TRANSITION_SUCCESS, state, fromState, opts);\n        done(null, state);\n      }\n    });\n  }\n\n  router.transitionToState = function (toState, fromState, options, done) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    if (done === void 0) {\n      done = noop;\n    }\n\n    router.cancel();\n    router.invokeEventListeners(constants.TRANSITION_START, toState, fromState);\n    cancelCurrentTransition = transition(router, toState, fromState, options, function (err, state) {\n      cancelCurrentTransition = null;\n      state = state || toState;\n\n      if (err) {\n        if (err.code === errorCodes.TRANSITION_CANCELLED) {\n          router.invokeEventListeners(constants.TRANSITION_CANCEL, toState, fromState);\n        } else {\n          router.invokeEventListeners(constants.TRANSITION_ERROR, toState, fromState, err);\n        }\n\n        done(err);\n      } else {\n        router.setState(state);\n        done(null, state);\n      }\n    });\n    return cancelCurrentTransition;\n  };\n\n  return router;\n}\n\nvar noop$1 = function () {};\n\nfunction withRouterLifecycle(router) {\n  var started = false;\n\n  router.isStarted = function () {\n    return started;\n  }; //@ts-ignore\n\n\n  router.start = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    var options = router.getOptions();\n    var lastArg = args[args.length - 1];\n    var done = typeof lastArg === 'function' ? lastArg : noop$1;\n    var startPathOrState = typeof args[0] !== 'function' ? args[0] : undefined;\n\n    if (started) {\n      done({\n        code: errorCodes.ROUTER_ALREADY_STARTED\n      });\n      return router;\n    }\n\n    var startPath, startState;\n    started = true;\n    router.invokeEventListeners(constants.ROUTER_START); // callback\n\n    var cb = function (err, state, invokeErrCb) {\n      if (invokeErrCb === void 0) {\n        invokeErrCb = true;\n      }\n\n      if (!err) router.invokeEventListeners(constants.TRANSITION_SUCCESS, state, null, {\n        replace: true\n      });\n      if (err && invokeErrCb) router.invokeEventListeners(constants.TRANSITION_ERROR, state, null, err);\n      done(err, state);\n    };\n\n    if (startPathOrState === undefined && !options.defaultRoute) {\n      return cb({\n        code: errorCodes.NO_START_PATH_OR_STATE\n      });\n    }\n\n    if (typeof startPathOrState === 'string') {\n      startPath = startPathOrState;\n    } else if (typeof startPathOrState === 'object') {\n      startState = startPathOrState;\n    }\n\n    if (!startState) {\n      // If no supplied start state, get start state\n      startState = startPath === undefined ? null : router.matchPath(startPath); // Navigate to default function\n\n      var navigateToDefault_1 = function () {\n        return router.navigateToDefault({\n          replace: true\n        }, done);\n      };\n\n      var redirect_1 = function (route) {\n        return router.navigate(route.name, route.params, {\n          replace: true,\n          reload: true,\n          redirected: true\n        }, done);\n      };\n\n      var transitionToState = function (state) {\n        router.transitionToState(state, router.getState(), {}, function (err, state) {\n          if (!err) cb(null, state);else if (err.redirect) redirect_1(err.redirect);else if (options.defaultRoute) navigateToDefault_1();else cb(err, null, false);\n        });\n      }; // If matched start path\n\n\n      if (startState) {\n        transitionToState(startState);\n      } else if (options.defaultRoute) {\n        // If default, navigate to default\n        navigateToDefault_1();\n      } else if (options.allowNotFound) {\n        transitionToState(router.makeNotFoundState(startPath, {\n          replace: true\n        }));\n      } else {\n        // No start match, no default => do nothing\n        cb({\n          code: errorCodes.ROUTE_NOT_FOUND,\n          path: startPath\n        }, null);\n      }\n    } else {\n      // Initialise router with provided start state\n      router.setState(startState);\n      cb(null, startState);\n    }\n\n    return router;\n  };\n\n  router.stop = function () {\n    if (started) {\n      router.setState(null);\n      started = false;\n      router.invokeEventListeners(constants.ROUTER_STOP);\n    }\n\n    return router;\n  };\n\n  return router;\n}\n\nvar toFunction = function (val) {\n  return typeof val === 'function' ? val : function () {\n    return function () {\n      return val;\n    };\n  };\n};\n\nfunction withRouteLifecycle(router) {\n  var canDeactivateFactories = {};\n  var canActivateFactories = {};\n  var canDeactivateFunctions = {};\n  var canActivateFunctions = {};\n\n  router.getLifecycleFactories = function () {\n    return [canDeactivateFactories, canActivateFactories];\n  };\n\n  router.getLifecycleFunctions = function () {\n    return [canDeactivateFunctions, canActivateFunctions];\n  };\n\n  router.canDeactivate = function (name, canDeactivateHandler) {\n    var factory = toFunction(canDeactivateHandler);\n    canDeactivateFactories[name] = factory;\n    canDeactivateFunctions[name] = router.executeFactory(factory);\n    return router;\n  };\n\n  router.clearCanDeactivate = function (name) {\n    canDeactivateFactories[name] = undefined;\n    canDeactivateFunctions[name] = undefined;\n    return router;\n  };\n\n  router.canActivate = function (name, canActivateHandler) {\n    var factory = toFunction(canActivateHandler);\n    canActivateFactories[name] = factory;\n    canActivateFunctions[name] = router.executeFactory(factory);\n    return router;\n  };\n\n  return router;\n}\n\nvar pipe = function () {\n  var fns = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    fns[_i] = arguments[_i];\n  }\n\n  return function (arg) {\n    return fns.reduce(function (prev, fn) {\n      return fn(prev);\n    }, arg);\n  };\n};\n\nvar createRouter = function (routes, options, dependencies) {\n  if (routes === void 0) {\n    routes = [];\n  }\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  if (dependencies === void 0) {\n    dependencies = {};\n  }\n\n  var config = {\n    decoders: {},\n    encoders: {},\n    defaultParams: {},\n    forwardMap: {}\n  };\n  return pipe(withOptions(options), withDependencies(dependencies), withObservability, withState, withRouterLifecycle, withRouteLifecycle, withNavigation, withPlugins, withMiddleware, withRoutes(routes))({\n    config: config\n  });\n};\n\nfunction cloneRouter(router, dependencies) {\n  var clonedRouter = createRouter(router.rootNode, router.getOptions(), dependencies);\n  clonedRouter.useMiddleware.apply(clonedRouter, router.getMiddlewareFactories());\n  clonedRouter.usePlugin.apply(clonedRouter, router.getPlugins());\n  clonedRouter.config = router.config;\n\n  var _a = router.getLifecycleFactories(),\n      canDeactivateFactories = _a[0],\n      canActivateFactories = _a[1];\n\n  Object.keys(canDeactivateFactories).forEach(function (name) {\n    return clonedRouter.canDeactivate(name, canDeactivateFactories[name]);\n  });\n  Object.keys(canActivateFactories).forEach(function (name) {\n    return clonedRouter.canActivate(name, canActivateFactories[name]);\n  });\n  return clonedRouter;\n}\n\nexport default createRouter;\nexport { cloneRouter, constants, createRouter, errorCodes };","map":{"version":3,"sources":["/home/znjuko/Рабочий стол/rk2/bmstu_front/default-chat-golang/front/node_modules/router5/dist/index.es.js"],"names":["RouteNode","$$observable","transitionPath","nameToIDs","default","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defaultOptions","trailingSlashMode","queryParamsMode","strictTrailingSlash","autoCleanUp","allowNotFound","strongMatching","rewritePathOnMatch","caseSensitive","urlParamsEncoding","withOptions","options","router","routerOptions","getOptions","setOption","option","value","errorCodes","ROUTER_NOT_STARTED","NO_START_PATH_OR_STATE","ROUTER_ALREADY_STARTED","ROUTE_NOT_FOUND","SAME_STATES","CANNOT_DEACTIVATE","CANNOT_ACTIVATE","TRANSITION_ERR","TRANSITION_CANCELLED","constants","UNKNOWN_ROUTE","ROUTER_START","ROUTER_STOP","TRANSITION_START","TRANSITION_CANCEL","TRANSITION_SUCCESS","TRANSITION_ERROR","withRoutes","routes","forward","fromRoute","toRoute","config","forwardMap","rootNode","onAdd","onRouteAdded","route","canActivate","name","forwardTo","decodeParams","decoders","encodeParams","encoders","defaultParams","add","finalSort","sortDescendants","addNode","path","canActivateHandler","isActive","params","strictEquality","ignoreQueryParams","activeState","getState","areStatesEqual","makeState","areStatesDescendants","buildPath","paramsWithDefault","_a","queryParams","encodedParams","matchPath","source","match","name_1","meta","decodedParams","forwardState","routeName","routeParams","builtPath","setRootPath","rootPath","setPath","withDependencies","dependencies","routerDependencies","setDependency","dependencyName","dependency","setDependencies","deps","keys","forEach","getDependencies","getInjectables","executeFactory","factoryFunction","withState","stateId","routerState","setState","state","forceId","id","undefined","makeNotFoundState","state1","state2","getUrlParams","getSegmentsByName","map","segment","parser","reduce","concat","state1Params","state2Params","every","parentState","childState","regex","RegExp","test","buildState","eventsMap","onStart","onStop","onTransitionSuccess","onTransitionStart","onTransitionError","onTransitionCancel","withPlugins","routerPlugins","getPlugins","usePlugin","plugins","_i","removePluginFns","plugin","push","startPlugin","filter","indexOf","removePlugin","appliedPlugin","removeEventListeners","methodName","addEventListener","Boolean","removeListener","teardown","withMiddleware","middlewareFactories","middlewareFunctions","useMiddleware","middlewares","middleware","middlewareFunction","m","fn","clearMiddleware","getMiddlewareFactories","getMiddlewareFunctions","withObservability","callbacks","invokeEventListeners","eventName","args","cb","removeEventListener","_cb","subscribe","listener","isObject","finalListener","next","bind","unsubscribeHandler","toState","fromState","previousRoute","unsubscribe","observable","observer","TypeError","resolve","functions","callback","isCancelled","_b","errorKey","remainingFunctions","Array","isArray","isState","obj","hasStateChanged","mergeStates","processFn","stepFn","errBase","_done","done","err","newState","console","error","res","then","resVal","Error","stack","promiseError","isMapped","slice","transition","opts","cancelled","completed","getLifecycleFunctions","canDeactivateFunctions","canActivateFunctions","cancel","code","activeSegments_1","clearCanDeactivate","makeError","base","isUnknownRoute","asyncBase","toDeactivate","toActivate","canDeactivate","forceDeactivate","canDeactivateFunctionMap","fnMap","canActivateFunctionMap","pipeline","noop","withNavigation","cancelCurrentTransition","navigate","navigateToDefault","defaultRoute","lastArg","isStarted","sameStates","reload","force","skipTransition","transitionToState","redirect","params_1","redirected","noop$1","withRouterLifecycle","started","start","startPathOrState","startPath","startState","invokeErrCb","replace","navigateToDefault_1","redirect_1","stop","toFunction","val","withRouteLifecycle","canDeactivateFactories","canActivateFactories","getLifecycleFactories","canDeactivateHandler","factory","pipe","fns","arg","prev","createRouter","cloneRouter","clonedRouter"],"mappings":"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","sourcesContent":["import { RouteNode } from 'route-node';\nexport { RouteNode } from 'route-node';\nimport $$observable from 'symbol-observable';\nimport transitionPath, { nameToIDs } from 'router5-transition-path';\nexport { default as transitionPath } from 'router5-transition-path';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\n\nvar defaultOptions = {\r\n    trailingSlashMode: 'default',\r\n    queryParamsMode: 'default',\r\n    strictTrailingSlash: false,\r\n    autoCleanUp: true,\r\n    allowNotFound: false,\r\n    strongMatching: true,\r\n    rewritePathOnMatch: true,\r\n    caseSensitive: false,\r\n    urlParamsEncoding: 'default'\r\n};\r\nfunction withOptions(options) {\r\n    return function (router) {\r\n        var routerOptions = __assign(__assign({}, defaultOptions), options);\r\n        router.getOptions = function () { return routerOptions; };\r\n        router.setOption = function (option, value) {\r\n            routerOptions[option] = value;\r\n            return router;\r\n        };\r\n        return router;\r\n    };\r\n}\n\nvar errorCodes = {\r\n    ROUTER_NOT_STARTED: 'NOT_STARTED',\r\n    NO_START_PATH_OR_STATE: 'NO_START_PATH_OR_STATE',\r\n    ROUTER_ALREADY_STARTED: 'ALREADY_STARTED',\r\n    ROUTE_NOT_FOUND: 'ROUTE_NOT_FOUND',\r\n    SAME_STATES: 'SAME_STATES',\r\n    CANNOT_DEACTIVATE: 'CANNOT_DEACTIVATE',\r\n    CANNOT_ACTIVATE: 'CANNOT_ACTIVATE',\r\n    TRANSITION_ERR: 'TRANSITION_ERR',\r\n    TRANSITION_CANCELLED: 'CANCELLED'\r\n};\r\nvar constants = {\r\n    UNKNOWN_ROUTE: '@@router5/UNKNOWN_ROUTE',\r\n    ROUTER_START: '$start',\r\n    ROUTER_STOP: '$stop',\r\n    TRANSITION_START: '$$start',\r\n    TRANSITION_CANCEL: '$$cancel',\r\n    TRANSITION_SUCCESS: '$$success',\r\n    TRANSITION_ERROR: '$$error'\r\n};\n\nfunction withRoutes(routes) {\r\n    return function (router) {\r\n        router.forward = function (fromRoute, toRoute) {\r\n            router.config.forwardMap[fromRoute] = toRoute;\r\n            return router;\r\n        };\r\n        var rootNode = routes instanceof RouteNode\r\n            ? routes\r\n            : new RouteNode('', '', routes, { onAdd: onRouteAdded });\r\n        function onRouteAdded(route) {\r\n            if (route.canActivate)\r\n                router.canActivate(route.name, route.canActivate);\r\n            if (route.forwardTo)\r\n                router.forward(route.name, route.forwardTo);\r\n            if (route.decodeParams)\r\n                router.config.decoders[route.name] = route.decodeParams;\r\n            if (route.encodeParams)\r\n                router.config.encoders[route.name] = route.encodeParams;\r\n            if (route.defaultParams)\r\n                router.config.defaultParams[route.name] = route.defaultParams;\r\n        }\r\n        router.rootNode = rootNode;\r\n        router.add = function (routes, finalSort) {\r\n            rootNode.add(routes, onRouteAdded, !finalSort);\r\n            if (finalSort) {\r\n                rootNode.sortDescendants();\r\n            }\r\n            return router;\r\n        };\r\n        router.addNode = function (name, path, canActivateHandler) {\r\n            rootNode.addNode(name, path);\r\n            if (canActivateHandler)\r\n                router.canActivate(name, canActivateHandler);\r\n            return router;\r\n        };\r\n        router.isActive = function (name, params, strictEquality, ignoreQueryParams) {\r\n            if (params === void 0) { params = {}; }\r\n            if (strictEquality === void 0) { strictEquality = false; }\r\n            if (ignoreQueryParams === void 0) { ignoreQueryParams = true; }\r\n            var activeState = router.getState();\r\n            if (!activeState)\r\n                return false;\r\n            if (strictEquality || activeState.name === name) {\r\n                return router.areStatesEqual(router.makeState(name, params), activeState, ignoreQueryParams);\r\n            }\r\n            return router.areStatesDescendants(router.makeState(name, params), activeState);\r\n        };\r\n        router.buildPath = function (route, params) {\r\n            if (route === constants.UNKNOWN_ROUTE) {\r\n                return params.path;\r\n            }\r\n            var paramsWithDefault = __assign(__assign({}, router.config.defaultParams[route]), params);\r\n            var _a = router.getOptions(), trailingSlashMode = _a.trailingSlashMode, queryParamsMode = _a.queryParamsMode, queryParams = _a.queryParams;\r\n            var encodedParams = router.config.encoders[route]\r\n                ? router.config.encoders[route](paramsWithDefault)\r\n                : paramsWithDefault;\r\n            return router.rootNode.buildPath(route, encodedParams, {\r\n                trailingSlashMode: trailingSlashMode,\r\n                queryParamsMode: queryParamsMode,\r\n                queryParams: queryParams,\r\n                urlParamsEncoding: router.getOptions().urlParamsEncoding\r\n            });\r\n        };\r\n        router.matchPath = function (path, source) {\r\n            var options = router.getOptions();\r\n            var match = router.rootNode.matchPath(path, options);\r\n            if (match) {\r\n                var name_1 = match.name, params = match.params, meta = match.meta;\r\n                var decodedParams = router.config.decoders[name_1]\r\n                    ? router.config.decoders[name_1](params)\r\n                    : params;\r\n                var _a = router.forwardState(name_1, decodedParams), routeName = _a.name, routeParams = _a.params;\r\n                var builtPath = options.rewritePathOnMatch === false\r\n                    ? path\r\n                    : router.buildPath(routeName, routeParams);\r\n                return router.makeState(routeName, routeParams, builtPath, {\r\n                    params: meta,\r\n                    source: source\r\n                });\r\n            }\r\n            return null;\r\n        };\r\n        router.setRootPath = function (rootPath) {\r\n            router.rootNode.setPath(rootPath);\r\n        };\r\n        return router;\r\n    };\r\n}\n\nfunction withDependencies(dependencies) {\r\n    return function (router) {\r\n        var routerDependencies = dependencies;\r\n        router.setDependency = function (dependencyName, dependency) {\r\n            routerDependencies[dependencyName] = dependency;\r\n            return router;\r\n        };\r\n        router.setDependencies = function (deps) {\r\n            Object.keys(deps).forEach(function (name) {\r\n                return router.setDependency(name, deps[name]);\r\n            });\r\n            return router;\r\n        };\r\n        router.getDependencies = function () { return routerDependencies; };\r\n        router.getInjectables = function () { return [router, router.getDependencies()]; };\r\n        router.executeFactory = function (factoryFunction) {\r\n            return factoryFunction.apply(void 0, router.getInjectables());\r\n        };\r\n        return router;\r\n    };\r\n}\n\nfunction withState(router) {\r\n    var stateId = 0;\r\n    var routerState = null;\r\n    router.getState = function () { return routerState; };\r\n    router.setState = function (state) {\r\n        routerState = state;\r\n    };\r\n    router.makeState = function (name, params, path, meta, forceId) { return ({\r\n        name: name,\r\n        params: __assign(__assign({}, router.config.defaultParams[name]), params),\r\n        path: path,\r\n        meta: meta\r\n            ? __assign(__assign({}, meta), { id: forceId === undefined ? ++stateId : forceId }) : undefined\r\n    }); };\r\n    router.makeNotFoundState = function (path, options) {\r\n        return router.makeState(constants.UNKNOWN_ROUTE, { path: path }, path, {\r\n            options: options\r\n        });\r\n    };\r\n    router.areStatesEqual = function (state1, state2, ignoreQueryParams) {\r\n        if (ignoreQueryParams === void 0) { ignoreQueryParams = true; }\r\n        if (state1.name !== state2.name)\r\n            return false;\r\n        var getUrlParams = function (name) {\r\n            return router.rootNode\r\n                //@ts-ignore\r\n                .getSegmentsByName(name)\r\n                .map(function (segment) { return segment.parser['urlParams']; })\r\n                .reduce(function (params, p) { return params.concat(p); }, []);\r\n        };\r\n        var state1Params = ignoreQueryParams\r\n            ? getUrlParams(state1.name)\r\n            : Object.keys(state1.params);\r\n        var state2Params = ignoreQueryParams\r\n            ? getUrlParams(state2.name)\r\n            : Object.keys(state2.params);\r\n        return (state1Params.length === state2Params.length &&\r\n            state1Params.every(function (p) { return state1.params[p] === state2.params[p]; }));\r\n    };\r\n    router.areStatesDescendants = function (parentState, childState) {\r\n        var regex = new RegExp('^' + parentState.name + '\\\\.(.*)$');\r\n        if (!regex.test(childState.name))\r\n            return false;\r\n        // If child state name extends parent state name, and all parent state params\r\n        // are in child state params.\r\n        return Object.keys(parentState.params).every(function (p) { return parentState.params[p] === childState.params[p]; });\r\n    };\r\n    router.forwardState = function (routeName, routeParams) {\r\n        var name = router.config.forwardMap[routeName] || routeName;\r\n        var params = __assign(__assign(__assign({}, router.config.defaultParams[routeName]), router.config.defaultParams[name]), routeParams);\r\n        return {\r\n            name: name,\r\n            params: params\r\n        };\r\n    };\r\n    router.buildState = function (routeName, routeParams) {\r\n        var _a = router.forwardState(routeName, routeParams), name = _a.name, params = _a.params;\r\n        return router.rootNode.buildState(name, params);\r\n    };\r\n    return router;\r\n}\n\nvar eventsMap = {\r\n    onStart: constants.ROUTER_START,\r\n    onStop: constants.ROUTER_STOP,\r\n    onTransitionSuccess: constants.TRANSITION_SUCCESS,\r\n    onTransitionStart: constants.TRANSITION_START,\r\n    onTransitionError: constants.TRANSITION_ERROR,\r\n    onTransitionCancel: constants.TRANSITION_CANCEL\r\n};\r\nfunction withPlugins(router) {\r\n    var routerPlugins = [];\r\n    router.getPlugins = function () { return routerPlugins; };\r\n    router.usePlugin = function () {\r\n        var plugins = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            plugins[_i] = arguments[_i];\r\n        }\r\n        var removePluginFns = plugins.map(function (plugin) {\r\n            routerPlugins.push(plugin);\r\n            return startPlugin(plugin);\r\n        });\r\n        return function () {\r\n            routerPlugins = routerPlugins.filter(function (plugin) { return plugins.indexOf(plugin) === -1; });\r\n            removePluginFns.forEach(function (removePlugin) { return removePlugin(); });\r\n        };\r\n    };\r\n    function startPlugin(plugin) {\r\n        var appliedPlugin = router.executeFactory(plugin);\r\n        var removeEventListeners = Object.keys(eventsMap)\r\n            .map(function (methodName) {\r\n            if (appliedPlugin[methodName]) {\r\n                return router.addEventListener(eventsMap[methodName], appliedPlugin[methodName]);\r\n            }\r\n        })\r\n            .filter(Boolean);\r\n        return function () {\r\n            removeEventListeners.forEach(function (removeListener) { return removeListener(); });\r\n            if (appliedPlugin.teardown) {\r\n                appliedPlugin.teardown();\r\n            }\r\n        };\r\n    }\r\n    return router;\r\n}\n\nfunction withMiddleware(router) {\r\n    var middlewareFactories = [];\r\n    var middlewareFunctions = [];\r\n    router.useMiddleware = function () {\r\n        var middlewares = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            middlewares[_i] = arguments[_i];\r\n        }\r\n        var removePluginFns = middlewares.map(function (middleware) {\r\n            var middlewareFunction = router.executeFactory(middleware);\r\n            middlewareFactories.push(middleware);\r\n            middlewareFunctions.push(middlewareFunction);\r\n            return function () {\r\n                middlewareFactories = middlewareFactories.filter(function (m) { return m !== middleware; });\r\n                middlewareFunctions = middlewareFunctions.filter(function (m) { return m !== middlewareFunction; });\r\n            };\r\n        });\r\n        return function () { return removePluginFns.forEach(function (fn) { return fn(); }); };\r\n    };\r\n    router.clearMiddleware = function () {\r\n        middlewareFactories = [];\r\n        middlewareFunctions = [];\r\n        return router;\r\n    };\r\n    router.getMiddlewareFactories = function () { return middlewareFactories; };\r\n    router.getMiddlewareFunctions = function () { return middlewareFunctions; };\r\n    return router;\r\n}\n\nfunction withObservability(router) {\r\n    var callbacks = {};\r\n    router.invokeEventListeners = function (eventName) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        (callbacks[eventName] || []).forEach(function (cb) { return cb.apply(void 0, args); });\r\n    };\r\n    router.removeEventListener = function (eventName, cb) {\r\n        callbacks[eventName] = callbacks[eventName].filter(function (_cb) { return _cb !== cb; });\r\n    };\r\n    router.addEventListener = function (eventName, cb) {\r\n        callbacks[eventName] = (callbacks[eventName] || []).concat(cb);\r\n        return function () { return router.removeEventListener(eventName, cb); };\r\n    };\r\n    function subscribe(listener) {\r\n        var isObject = typeof listener === 'object';\r\n        var finalListener = isObject ? listener.next.bind(listener) : listener;\r\n        var unsubscribeHandler = router.addEventListener(constants.TRANSITION_SUCCESS, function (toState, fromState) {\r\n            finalListener({\r\n                route: toState,\r\n                previousRoute: fromState\r\n            });\r\n        });\r\n        return isObject\r\n            ? { unsubscribe: unsubscribeHandler }\r\n            : unsubscribeHandler;\r\n    }\r\n    function observable() {\r\n        var _a;\r\n        return _a = {\r\n                subscribe: function (observer) {\r\n                    if (typeof observer !== 'object' || observer === null) {\r\n                        throw new TypeError('Expected the observer to be an object.');\r\n                    }\r\n                    return subscribe(observer);\r\n                }\r\n            },\r\n            _a[$$observable] = function () {\r\n                return this;\r\n            },\r\n            _a;\r\n    }\r\n    router.subscribe = subscribe;\r\n    //@ts-ignore\r\n    router[$$observable] = observable;\r\n    //@ts-ignore\r\n    router['@@observable'] = observable;\r\n    return router;\r\n}\n\nfunction resolve(functions, _a, callback) {\r\n    var isCancelled = _a.isCancelled, toState = _a.toState, fromState = _a.fromState, _b = _a.errorKey, errorKey = _b === void 0 ? undefined : _b;\r\n    var remainingFunctions = Array.isArray(functions)\r\n        ? functions\r\n        : Object.keys(functions);\r\n    var isState = function (obj) {\r\n        return typeof obj === 'object' &&\r\n            obj.name !== undefined &&\r\n            obj.params !== undefined &&\r\n            obj.path !== undefined;\r\n    };\r\n    var hasStateChanged = function (toState, fromState) {\r\n        return fromState.name !== toState.name ||\r\n            fromState.params !== toState.params ||\r\n            fromState.path !== toState.path;\r\n    };\r\n    var mergeStates = function (toState, fromState) { return (__assign(__assign(__assign({}, fromState), toState), { meta: __assign(__assign({}, fromState.meta), toState.meta) })); };\r\n    var processFn = function (stepFn, errBase, state, _done) {\r\n        var done = function (err, newState) {\r\n            if (err) {\r\n                _done(err);\r\n            }\r\n            else if (newState && newState !== state && isState(newState)) {\r\n                if (hasStateChanged(newState, state)) {\r\n                    console.error('[router5][transition] Warning: state values (name, params, path) were changed during transition process.');\r\n                }\r\n                _done(null, mergeStates(newState, state));\r\n            }\r\n            else {\r\n                _done(null, state);\r\n            }\r\n        };\r\n        var res = stepFn.call(null, state, fromState, done);\r\n        if (isCancelled()) {\r\n            done(null);\r\n        }\r\n        else if (typeof res === 'boolean') {\r\n            done(res ? null : errBase);\r\n        }\r\n        else if (isState(res)) {\r\n            done(null, res);\r\n        }\r\n        else if (res && typeof res.then === 'function') {\r\n            res.then(function (resVal) {\r\n                if (resVal instanceof Error)\r\n                    done({ error: resVal }, null);\r\n                else\r\n                    done(null, resVal);\r\n            }, function (err) {\r\n                if (err instanceof Error) {\r\n                    console.error(err.stack || err);\r\n                    done(__assign(__assign({}, errBase), { promiseError: err }), null);\r\n                }\r\n                else {\r\n                    done(typeof err === 'object'\r\n                        ? __assign(__assign({}, errBase), err) : errBase, null);\r\n                }\r\n            });\r\n        }\r\n        // else: wait for done to be called\r\n    };\r\n    var next = function (err, state) {\r\n        var _a;\r\n        if (isCancelled()) {\r\n            callback();\r\n        }\r\n        else if (err) {\r\n            callback(err);\r\n        }\r\n        else {\r\n            if (!remainingFunctions.length) {\r\n                callback(null, state);\r\n            }\r\n            else {\r\n                var isMapped = typeof remainingFunctions[0] === 'string';\r\n                var errBase = errorKey && isMapped\r\n                    ? (_a = {}, _a[errorKey] = remainingFunctions[0], _a) : {};\r\n                var stepFn = isMapped\r\n                    ? functions[remainingFunctions[0]]\r\n                    : remainingFunctions[0];\r\n                remainingFunctions = remainingFunctions.slice(1);\r\n                processFn(stepFn, errBase, state, next);\r\n            }\r\n        }\r\n    };\r\n    next(null, toState);\r\n}\n\nfunction transition(router, toState, fromState, opts, callback) {\r\n    var cancelled = false;\r\n    var completed = false;\r\n    var options = router.getOptions();\r\n    var _a = router.getLifecycleFunctions(), canDeactivateFunctions = _a[0], canActivateFunctions = _a[1];\r\n    var middlewareFunctions = router.getMiddlewareFunctions();\r\n    var isCancelled = function () { return cancelled; };\r\n    var cancel = function () {\r\n        if (!cancelled && !completed) {\r\n            cancelled = true;\r\n            callback({ code: errorCodes.TRANSITION_CANCELLED }, null);\r\n        }\r\n    };\r\n    var done = function (err, state) {\r\n        completed = true;\r\n        if (isCancelled()) {\r\n            return;\r\n        }\r\n        if (!err && options.autoCleanUp) {\r\n            var activeSegments_1 = nameToIDs(toState.name);\r\n            Object.keys(canDeactivateFunctions).forEach(function (name) {\r\n                if (activeSegments_1.indexOf(name) === -1)\r\n                    router.clearCanDeactivate(name);\r\n            });\r\n        }\r\n        callback(err, state || toState);\r\n    };\r\n    var makeError = function (base, err) { return (__assign(__assign({}, base), (err instanceof Object ? err : { error: err }))); };\r\n    var isUnknownRoute = toState.name === constants.UNKNOWN_ROUTE;\r\n    var asyncBase = { isCancelled: isCancelled, toState: toState, fromState: fromState };\r\n    var _b = transitionPath(toState, fromState), toDeactivate = _b.toDeactivate, toActivate = _b.toActivate;\r\n    var canDeactivate = !fromState || opts.forceDeactivate\r\n        ? []\r\n        : function (toState, fromState, cb) {\r\n            var canDeactivateFunctionMap = toDeactivate\r\n                .filter(function (name) { return canDeactivateFunctions[name]; })\r\n                .reduce(function (fnMap, name) {\r\n                var _a;\r\n                return (__assign(__assign({}, fnMap), (_a = {}, _a[name] = canDeactivateFunctions[name], _a)));\r\n            }, {});\r\n            resolve(canDeactivateFunctionMap, __assign(__assign({}, asyncBase), { errorKey: 'segment' }), function (err) {\r\n                return cb(err\r\n                    ? makeError({ code: errorCodes.CANNOT_DEACTIVATE }, err)\r\n                    : null);\r\n            });\r\n        };\r\n    var canActivate = isUnknownRoute\r\n        ? []\r\n        : function (toState, fromState, cb) {\r\n            var canActivateFunctionMap = toActivate\r\n                .filter(function (name) { return canActivateFunctions[name]; })\r\n                .reduce(function (fnMap, name) {\r\n                var _a;\r\n                return (__assign(__assign({}, fnMap), (_a = {}, _a[name] = canActivateFunctions[name], _a)));\r\n            }, {});\r\n            resolve(canActivateFunctionMap, __assign(__assign({}, asyncBase), { errorKey: 'segment' }), function (err) {\r\n                return cb(err\r\n                    ? makeError({ code: errorCodes.CANNOT_ACTIVATE }, err)\r\n                    : null);\r\n            });\r\n        };\r\n    var middleware = !middlewareFunctions.length\r\n        ? []\r\n        : function (toState, fromState, cb) {\r\n            return resolve(middlewareFunctions, __assign({}, asyncBase), function (err, state) {\r\n                return cb(err\r\n                    ? makeError({ code: errorCodes.TRANSITION_ERR }, err)\r\n                    : null, state || toState);\r\n            });\r\n        };\r\n    var pipeline = []\r\n        .concat(canDeactivate)\r\n        .concat(canActivate)\r\n        .concat(middleware);\r\n    resolve(pipeline, asyncBase, done);\r\n    return cancel;\r\n}\n\nvar noop = function () { };\r\nfunction withNavigation(router) {\r\n    var cancelCurrentTransition;\r\n    router.navigate = navigate;\r\n    router.navigate = navigate;\r\n    router.navigateToDefault = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var opts = typeof args[0] === 'object' ? args[0] : {};\r\n        var done = args.length === 2\r\n            ? args[1]\r\n            : typeof args[0] === 'function'\r\n                ? args[0]\r\n                : noop;\r\n        var options = router.getOptions();\r\n        if (options.defaultRoute) {\r\n            return navigate(options.defaultRoute, options.defaultParams, opts, done);\r\n        }\r\n        return function () { };\r\n    };\r\n    router.cancel = function () {\r\n        if (cancelCurrentTransition) {\r\n            cancelCurrentTransition('navigate');\r\n            cancelCurrentTransition = null;\r\n        }\r\n        return router;\r\n    };\r\n    function navigate() {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var name = args[0];\r\n        var lastArg = args[args.length - 1];\r\n        var done = typeof lastArg === 'function' ? lastArg : noop;\r\n        var params = typeof args[1] === 'object' ? args[1] : {};\r\n        var opts = typeof args[2] === 'object' ? args[2] : {};\r\n        if (!router.isStarted()) {\r\n            done({ code: errorCodes.ROUTER_NOT_STARTED });\r\n            return;\r\n        }\r\n        var route = router.buildState(name, params);\r\n        if (!route) {\r\n            var err = { code: errorCodes.ROUTE_NOT_FOUND };\r\n            done(err);\r\n            router.invokeEventListeners(constants.TRANSITION_ERROR, null, router.getState(), err);\r\n            return;\r\n        }\r\n        var toState = router.makeState(route.name, route.params, router.buildPath(route.name, route.params), { params: route.meta, options: opts });\r\n        var sameStates = router.getState()\r\n            ? router.areStatesEqual(router.getState(), toState, false)\r\n            : false;\r\n        // Do not proceed further if states are the same and no reload\r\n        // (no deactivation and no callbacks)\r\n        if (sameStates && !opts.reload && !opts.force) {\r\n            var err = { code: errorCodes.SAME_STATES };\r\n            done(err);\r\n            router.invokeEventListeners(constants.TRANSITION_ERROR, toState, router.getState(), err);\r\n            return;\r\n        }\r\n        var fromState = router.getState();\r\n        if (opts.skipTransition) {\r\n            done(null, toState);\r\n            return noop;\r\n        }\r\n        // Transition\r\n        return router.transitionToState(toState, fromState, opts, function (err, state) {\r\n            if (err) {\r\n                if (err.redirect) {\r\n                    var _a = err.redirect, name_1 = _a.name, params_1 = _a.params;\r\n                    navigate(name_1, params_1, __assign(__assign({}, opts), { force: true, redirected: true }), done);\r\n                }\r\n                else {\r\n                    done(err);\r\n                }\r\n            }\r\n            else {\r\n                router.invokeEventListeners(constants.TRANSITION_SUCCESS, state, fromState, opts);\r\n                done(null, state);\r\n            }\r\n        });\r\n    }\r\n    router.transitionToState = function (toState, fromState, options, done) {\r\n        if (options === void 0) { options = {}; }\r\n        if (done === void 0) { done = noop; }\r\n        router.cancel();\r\n        router.invokeEventListeners(constants.TRANSITION_START, toState, fromState);\r\n        cancelCurrentTransition = transition(router, toState, fromState, options, function (err, state) {\r\n            cancelCurrentTransition = null;\r\n            state = state || toState;\r\n            if (err) {\r\n                if (err.code === errorCodes.TRANSITION_CANCELLED) {\r\n                    router.invokeEventListeners(constants.TRANSITION_CANCEL, toState, fromState);\r\n                }\r\n                else {\r\n                    router.invokeEventListeners(constants.TRANSITION_ERROR, toState, fromState, err);\r\n                }\r\n                done(err);\r\n            }\r\n            else {\r\n                router.setState(state);\r\n                done(null, state);\r\n            }\r\n        });\r\n        return cancelCurrentTransition;\r\n    };\r\n    return router;\r\n}\n\nvar noop$1 = function () { };\r\nfunction withRouterLifecycle(router) {\r\n    var started = false;\r\n    router.isStarted = function () { return started; };\r\n    //@ts-ignore\r\n    router.start = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        var options = router.getOptions();\r\n        var lastArg = args[args.length - 1];\r\n        var done = typeof lastArg === 'function' ? lastArg : noop$1;\r\n        var startPathOrState = typeof args[0] !== 'function' ? args[0] : undefined;\r\n        if (started) {\r\n            done({ code: errorCodes.ROUTER_ALREADY_STARTED });\r\n            return router;\r\n        }\r\n        var startPath, startState;\r\n        started = true;\r\n        router.invokeEventListeners(constants.ROUTER_START);\r\n        // callback\r\n        var cb = function (err, state, invokeErrCb) {\r\n            if (invokeErrCb === void 0) { invokeErrCb = true; }\r\n            if (!err)\r\n                router.invokeEventListeners(constants.TRANSITION_SUCCESS, state, null, { replace: true });\r\n            if (err && invokeErrCb)\r\n                router.invokeEventListeners(constants.TRANSITION_ERROR, state, null, err);\r\n            done(err, state);\r\n        };\r\n        if (startPathOrState === undefined && !options.defaultRoute) {\r\n            return cb({ code: errorCodes.NO_START_PATH_OR_STATE });\r\n        }\r\n        if (typeof startPathOrState === 'string') {\r\n            startPath = startPathOrState;\r\n        }\r\n        else if (typeof startPathOrState === 'object') {\r\n            startState = startPathOrState;\r\n        }\r\n        if (!startState) {\r\n            // If no supplied start state, get start state\r\n            startState =\r\n                startPath === undefined ? null : router.matchPath(startPath);\r\n            // Navigate to default function\r\n            var navigateToDefault_1 = function () {\r\n                return router.navigateToDefault({ replace: true }, done);\r\n            };\r\n            var redirect_1 = function (route) {\r\n                return router.navigate(route.name, route.params, { replace: true, reload: true, redirected: true }, done);\r\n            };\r\n            var transitionToState = function (state) {\r\n                router.transitionToState(state, router.getState(), {}, function (err, state) {\r\n                    if (!err)\r\n                        cb(null, state);\r\n                    else if (err.redirect)\r\n                        redirect_1(err.redirect);\r\n                    else if (options.defaultRoute)\r\n                        navigateToDefault_1();\r\n                    else\r\n                        cb(err, null, false);\r\n                });\r\n            };\r\n            // If matched start path\r\n            if (startState) {\r\n                transitionToState(startState);\r\n            }\r\n            else if (options.defaultRoute) {\r\n                // If default, navigate to default\r\n                navigateToDefault_1();\r\n            }\r\n            else if (options.allowNotFound) {\r\n                transitionToState(router.makeNotFoundState(startPath, { replace: true }));\r\n            }\r\n            else {\r\n                // No start match, no default => do nothing\r\n                cb({ code: errorCodes.ROUTE_NOT_FOUND, path: startPath }, null);\r\n            }\r\n        }\r\n        else {\r\n            // Initialise router with provided start state\r\n            router.setState(startState);\r\n            cb(null, startState);\r\n        }\r\n        return router;\r\n    };\r\n    router.stop = function () {\r\n        if (started) {\r\n            router.setState(null);\r\n            started = false;\r\n            router.invokeEventListeners(constants.ROUTER_STOP);\r\n        }\r\n        return router;\r\n    };\r\n    return router;\r\n}\n\nvar toFunction = function (val) { return (typeof val === 'function' ? val : function () { return function () { return val; }; }); };\r\nfunction withRouteLifecycle(router) {\r\n    var canDeactivateFactories = {};\r\n    var canActivateFactories = {};\r\n    var canDeactivateFunctions = {};\r\n    var canActivateFunctions = {};\r\n    router.getLifecycleFactories = function () {\r\n        return [canDeactivateFactories, canActivateFactories];\r\n    };\r\n    router.getLifecycleFunctions = function () {\r\n        return [canDeactivateFunctions, canActivateFunctions];\r\n    };\r\n    router.canDeactivate = function (name, canDeactivateHandler) {\r\n        var factory = toFunction(canDeactivateHandler);\r\n        canDeactivateFactories[name] = factory;\r\n        canDeactivateFunctions[name] = router.executeFactory(factory);\r\n        return router;\r\n    };\r\n    router.clearCanDeactivate = function (name) {\r\n        canDeactivateFactories[name] = undefined;\r\n        canDeactivateFunctions[name] = undefined;\r\n        return router;\r\n    };\r\n    router.canActivate = function (name, canActivateHandler) {\r\n        var factory = toFunction(canActivateHandler);\r\n        canActivateFactories[name] = factory;\r\n        canActivateFunctions[name] = router.executeFactory(factory);\r\n        return router;\r\n    };\r\n    return router;\r\n}\n\nvar pipe = function () {\r\n    var fns = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        fns[_i] = arguments[_i];\r\n    }\r\n    return function (arg) {\r\n        return fns.reduce(function (prev, fn) { return fn(prev); }, arg);\r\n    };\r\n};\r\nvar createRouter = function (routes, options, dependencies) {\r\n    if (routes === void 0) { routes = []; }\r\n    if (options === void 0) { options = {}; }\r\n    if (dependencies === void 0) { dependencies = {}; }\r\n    var config = {\r\n        decoders: {},\r\n        encoders: {},\r\n        defaultParams: {},\r\n        forwardMap: {}\r\n    };\r\n    return pipe(withOptions(options), withDependencies(dependencies), withObservability, withState, withRouterLifecycle, withRouteLifecycle, withNavigation, withPlugins, withMiddleware, withRoutes(routes))({ config: config });\r\n};\n\nfunction cloneRouter(router, dependencies) {\r\n    var clonedRouter = createRouter(router.rootNode, router.getOptions(), dependencies);\r\n    clonedRouter.useMiddleware.apply(clonedRouter, router.getMiddlewareFactories());\r\n    clonedRouter.usePlugin.apply(clonedRouter, router.getPlugins());\r\n    clonedRouter.config = router.config;\r\n    var _a = router.getLifecycleFactories(), canDeactivateFactories = _a[0], canActivateFactories = _a[1];\r\n    Object.keys(canDeactivateFactories).forEach(function (name) {\r\n        return clonedRouter.canDeactivate(name, canDeactivateFactories[name]);\r\n    });\r\n    Object.keys(canActivateFactories).forEach(function (name) {\r\n        return clonedRouter.canActivate(name, canActivateFactories[name]);\r\n    });\r\n    return clonedRouter;\r\n}\n\nexport default createRouter;\nexport { cloneRouter, constants, createRouter, errorCodes };\n"]},"metadata":{},"sourceType":"module"}